
&НаКлиенте
Процедура СтруктурныеЕдиницыПриАктивизацииСтроки(Элемент)
	
	Если Элемент.ТекущаяСтрока = Неопределено Тогда
		Возврат;
	КонецЕсли;
	
	Список.Отбор.Элементы.Очистить();
	Отбор = Список.Отбор.Элементы.Добавить(Тип("ЭлементОтбораКомпоновкиДанных"));
	Отбор.Использование = Истина;
	Отбор.ВидСравнения = ВидСравненияКомпоновкиДанных.Равно;
	Отбор.ЛевоеЗначение = Новый ПолеКомпоновкиДанных("Владелец");
	Отбор.ПравоеЗначение = Элемент.ТекущаяСтрока;
	
КонецПроцедуры

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	Если Параметры.ТолькоТекущаяСЕ Тогда
		Если ПараметрыСеанса.ТекущаяСтруктурнаяЕдиница.ЭтоГруппа Тогда
			СтруктурныеЕдиницы.ПроизвольныйЗапрос = Истина;
			СтруктурныеЕдиницы.ТекстЗапроса = "ВЫБРАТЬ
			                                  |	СтруктурныеЕдиницы.Ссылка,
			                                  |	СтруктурныеЕдиницы.Наименование,
			                                  |	СтруктурныеЕдиницы.Код
			                                  |ИЗ
			                                  |	Справочник.СтруктурныеЕдиницы КАК СтруктурныеЕдиницы
			                                  |ГДЕ
			                                  |	СтруктурныеЕдиницы.Ссылка В ИЕРАРХИИ(&Ссылка)
			                                  |
			                                  |СГРУППИРОВАТЬ ПО
			                                  |	СтруктурныеЕдиницы.Ссылка,
			                                  |	СтруктурныеЕдиницы.Наименование,
			                                  |	СтруктурныеЕдиницы.Код";
			
			СтруктурныеЕдиницы.Параметры.УстановитьЗначениеПараметра("Ссылка",ПараметрыСеанса.ТекущаяСтруктурнаяЕдиница);//V
		Иначе
			Список.Отбор.Элементы.Очистить();
			Отбор = Список.Отбор.Элементы.Добавить(Тип("ЭлементОтбораКомпоновкиДанных"));
			Отбор.Использование = Истина;
			Отбор.ВидСравнения = ВидСравненияКомпоновкиДанных.Равно;
			Отбор.ЛевоеЗначение = Новый ПолеКомпоновкиДанных("Владелец");
			Отбор.ПравоеЗначение = ПараметрыСеанса.ТекущаяСтруктурнаяЕдиница; //V
			Отбор.РежимОтображения = РежимОтображенияЭлементаНастройкиКомпоновкиДанных.Недоступный;
			
			Элементы.СтруктурныеЕдиницы.Видимость = Ложь;
		КонецЕсли;	
		Возврат;
	КонецЕсли;									  
	
КонецПроцедуры


