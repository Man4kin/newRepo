&НаКлиенте
Процедура ОбработкаКоманды(ПараметрКоманды, ПараметрыВыполненияКоманды)
	Если ПараметрыВыполненияКоманды.Источник.ИмяФормы = "Справочник.ПравилаАвтоЗаказов.Форма.ФормаЭлемента" Тогда
		Если ПараметрыВыполненияКоманды.Источник.РасписаниеНаФорме = Неопределено Тогда
			Расписание = ПолучитьРасписание(ПараметрКоманды);
			Если Расписание = Неопределено Тогда
				Расписание = Новый РасписаниеРегламентногоЗадания;
			КонецЕсли;	
		Иначе
			//при копировании
			Расписание = ПараметрыВыполненияКоманды.Источник.РасписаниеНаФорме;
		КонецЕсли;
	Иначе
		Расписание = ПолучитьРасписание(ПараметрКоманды);
		Если Расписание = Неопределено Тогда
			Расписание = Новый РасписаниеРегламентногоЗадания;
		КонецЕсли;	
	КонецЕсли;	
	Диалог = Новый ДиалогРасписанияРегламентногоЗадания(Расписание);
	Если Диалог.ОткрытьМодально() Тогда
		Расписание = Диалог.Расписание;
		Если ПараметрыВыполненияКоманды.Источник.ИмяФормы = "Справочник.ПравилаАвтоЗаказов.Форма.ФормаЭлемента" Тогда
			Оповестить("ИзмененоРасписаниеПравилАвтоЗаказа",Диалог.Расписание,ПараметрКоманды);
		Иначе
			ЗаписатьПредставлениеРасписания(ПараметрКоманды,Расписание);
			ОповеститьОбИзменении(ПараметрКоманды);
		КонецЕсли;	
	КонецЕсли;
КонецПроцедуры

&НаСервере
Функция ПолучитьРасписание(ПараметрКоманды)
	Расписание = ПараметрКоманды.Расписание.Получить();
	Возврат Расписание;
КонецФункции


&НаСервере
Функция ЗаписатьПредставлениеРасписания(ПараметрКоманды,Расписание)
	Объект = ПараметрКоманды.ПолучитьОбъект();
	Объект.Расписание = Новый ХранилищеЗначения(Расписание, Новый СжатиеДанных());
	Объект.ПредставлениеРасписания = Строка(Расписание);
	Объект.Записать();
	Объект.РегистрацияПравила();
КонецФункции	