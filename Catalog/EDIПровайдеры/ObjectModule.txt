
Процедура ПриЗаписи(Отказ)
	Если НЕ ПараметрыСеанса.ЭтоЦентр Тогда
		УзелКлиента = ПланыОбмена.ОбменEDIКлиент.НайтиПоРеквизиту("EDIПровайдер",Ссылка);
		Если УзелКлиента.Пустая() Тогда
			УстановитьПривилегированныйРежим(Истина);
			НовыйУзел = ПланыОбмена.ОбменEDIКлиент.СоздатьУзел();
			НовыйУзел.Код = Ссылка.Код;
			НовыйУзел.Наименование = Ссылка.Наименование;
			НовыйУзел.EDIПровайдер = Ссылка;
			НовыйУзел.Записать();
			РегламентноеЗаданиеОтправки = РегламентныеЗадания.СоздатьРегламентноеЗадание("ОтправкаДанныхEDIКлиент");
			РегламентноеЗаданиеОтправки.Использование = Истина;
			МассивПараметров = Новый Массив;
			МассивПараметров.Добавить(НовыйУзел.Ссылка);
			РегламентноеЗаданиеОтправки.Параметры = МассивПараметров;
			РегламентноеЗаданиеОтправки.Наименование = "EDI клиент "+Ссылка;
			РегламентноеЗаданиеОтправки.Записать();
			НовыйУзел.РегламентноеЗаданиеОтправки = Строка(РегламентноеЗаданиеОтправки.УникальныйИдентификатор);
			
			РегламентноеЗаданиеПолучения = РегламентныеЗадания.СоздатьРегламентноеЗадание("ПолучениеДанныхEDIКлиент");
			РегламентноеЗаданиеПолучения.Использование = Истина;
			МассивПараметров = Новый Массив;
			МассивПараметров.Добавить(НовыйУзел.Ссылка);
			РегламентноеЗаданиеПолучения.Параметры = МассивПараметров;
			РегламентноеЗаданиеПолучения.Наименование = "EDI клиент "+Ссылка;
			РегламентноеЗаданиеПолучения.Записать();
			НовыйУзел.РегламентноеЗаданиеПолучения = Строка(РегламентноеЗаданиеПолучения.УникальныйИдентификатор);
			
			НовыйУзел.Записать();
		КонецЕсли;	
		УзелКлиента = ПланыОбмена.ОбменEDIПоставщик.НайтиПоРеквизиту("EDIПровайдер",Ссылка);
		Если УзелКлиента.Пустая() Тогда
			УстановитьПривилегированныйРежим(Истина);
			НовыйУзел = ПланыОбмена.ОбменEDIПоставщик.СоздатьУзел();
			НовыйУзел.Код = Ссылка.Код;
			НовыйУзел.Наименование = Ссылка.Наименование;
			НовыйУзел.EDIПровайдер = Ссылка;
			НовыйУзел.Записать();
			ТекущееРегламентноеЗаданиеОтправка = РегламентныеЗадания.СоздатьРегламентноеЗадание("ОтправкаДанныхEDIПоставщик");
			ТекущееРегламентноеЗаданиеОтправка.Использование = Истина;
			МассивПараметров = Новый Массив;
			МассивПараметров.Добавить(НовыйУзел.Ссылка);
			ТекущееРегламентноеЗаданиеОтправка.Параметры = МассивПараметров;
			ТекущееРегламентноеЗаданиеОтправка.Наименование = "EDI поставщик Отправка"+Ссылка;
			ТекущееРегламентноеЗаданиеОтправка.Записать();
			
			ТекущееРегламентноеЗаданиеПолучение = РегламентныеЗадания.СоздатьРегламентноеЗадание("ПолучениеДанныхEDIПоставщик");
			ТекущееРегламентноеЗаданиеПолучение.Использование = Истина;
			МассивПараметров = Новый Массив;
			МассивПараметров.Добавить(НовыйУзел.Ссылка);
			ТекущееРегламентноеЗаданиеПолучение.Параметры = МассивПараметров;
			ТекущееРегламентноеЗаданиеПолучение.Наименование = "EDI поставщик Получение"+Ссылка;
			ТекущееРегламентноеЗаданиеПолучение.Записать();
			
			НовыйУзел.РегламентноеЗаданиеОтправки = Строка(ТекущееРегламентноеЗаданиеОтправка.УникальныйИдентификатор);
			НовыйУзел.РегламентноеЗаданиеПолучения = Строка(ТекущееРегламентноеЗаданиеПолучение.УникальныйИдентификатор);
			НовыйУзел.Записать();
		КонецЕсли;	
	КонецЕсли;		
КонецПроцедуры
