
&НаКлиенте
Процедура ОбработкаКоманды(ПараметрКоманды, ПараметрыВыполненияКоманды)
	//струкПараметры = Новый Структура;
	//струкПараметры.Вставить("Основание", ПараметрКоманды);
	Задача = СозданиеБП(ПараметрКоманды);
	Если Задача = Неопределено Тогда
		ОбщегоНазначенияКлиентСервер.СообщитьПользователю(
		НСтр("ru = 'Бизнес-процесс по созданию Структурной единицы запрещен или запрещено выполнение задачи ""Оповещение о новой структурной единице""!
		|Необходимо разрешить его использование для структурной единицы ""Центр"".'"));
	Иначе	
		Результат = УправлениеБизнесПроцессамиКлиент.ОткрытьФормуВыполненияЗадачи(Задача);
	КонецЕсли;	
КонецПроцедуры

&НаСервере
Функция СозданиеБП(Знач Основание)
	струкПараметры = Новый Структура;
	струкПараметры.Вставить("Основание", Основание[0]);
	струкПараметры.Вставить("БизнесПроцесс", БизнесПроцессы.НоваяСтруктурнаяЕдиница);
	струкПараметры.Вставить("Удалять", Истина); 
	струкПараметры.Вставить("Искать", Истина);
	БП = УправлениеБизнесПроцессамиСервер.ЗапуститьБизнесПроцесс(струкПараметры);
	Если БП = Неопределено Тогда
		Возврат Неопределено;
	КонецЕсли;
	Если Основание.Количество()>1 Тогда
		Для I=1 ПО Основание.Количество()-1 Цикл
			Если Основание[I] = Справочники.СтруктурныеЕдиницы.Центр Тогда
				Продолжить;
			КонецЕсли;	
			Если Основание[I].ЭтоГруппа Тогда
				Продолжить;
			КонецЕсли;	
			Строка = БП.СтруктурныеЕдиницы.Добавить();
			Строка.СтруктурнаяЕдиница = Основание[I];
		КонецЦикла;
		БП.Записать();
	КонецЕсли;
	ЗадачиБП = УправлениеБизнесПроцессамиСервер.ПолучитьСписокЗадач(БП.Ссылка);
	Если ЗадачиБП.Количество() = 0 Тогда
		Возврат Неопределено;
	КонецЕсли;	
	Задача = ЗадачиБП[0];
	Возврат Задача;
КонецФункции

