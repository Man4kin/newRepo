&НаКлиенте
Процедура Очистить(Команда)
	Элементы.ДеревоПараметров.ТекущиеДанные.Значение = "";
	Элементы.ДеревоПараметров.ТекущиеДанные.Представление = "";
КонецПроцедуры


&НаКлиенте
Процедура ДеревоПараметровПриИзменении(Элемент)
	Модифицированность = Истина;
КонецПроцедуры


&НаКлиенте
Процедура ДеревоПараметровПриНачалеРедактирования(Элемент, НоваяСтрока, Копирование)
	Элемент.ПодчиненныеЭлементы.ДеревоПараметровПредставление.ОграничениеТипа = Элемент.ТекущиеДанные.ТипЗначенияСвойства;
КонецПроцедуры


&НаКлиенте
Процедура ДеревоПараметровПередНачаломИзменения(Элемент, Отказ)
	Если Элемент.ТекущиеДанные.Картинка = 1 Тогда
		Отказ = Истина;
		Возврат;
	КонецЕсли;
	Если Найти(Элемент.ТекущиеДанные.Свойство,"Расписание")<>0 Тогда
		Отказ = Истина;
		Расписание = ?(ПустаяСтрока(Элемент.ТекущиеДанные.Значение),Новый РасписаниеРегламентногоЗадания,РегламентныеЗаданияСервер.ПолучитьЗначениеИзСтроки(Элемент.ТекущиеДанные.Значение));
		Диалог = Новый ДиалогРасписанияРегламентногоЗадания(Расписание);
		Если Диалог.ОткрытьМодально() Тогда
			Расписание = Диалог.Расписание;
			Элемент.ТекущиеДанные.Значение = РегламентныеЗаданияСервер.ЗаписатьЗначениеВСтроку(Расписание);
			Элемент.ТекущиеДанные.Представление = Строка(Диалог.Расписание);
		КонецЕсли;
	КонецЕсли;
КонецПроцедуры


&НаКлиенте
Процедура ДеревоПараметровПредставлениеПриИзменении(Элемент)
	Если Найти(Элементы.ДеревоПараметров.ТекущиеДанные.Свойство,"Расписание") = 0 Тогда
		Элементы.ДеревоПараметров.ТекущиеДанные.Значение = Элементы.ДеревоПараметров.ТекущиеДанные.Представление;
	КонецЕсли;
	Если Найти(Элементы.ДеревоПараметров.ТекущиеДанные.Свойство,"Пароль")<>0 Тогда
		Если ЗначениеЗаполнено(Элементы.ДеревоПараметров.ТекущиеДанные.Значение) Тогда
			Элементы.ДеревоПараметров.ТекущиеДанные.Представление = "**********";
		КонецЕсли	
	КонецЕсли;	
КонецПроцедуры


&НаСервере
Процедура ПриЗаписиНаСервере(Отказ, ТекущийОбъект, ПараметрыЗаписи)
	УправлениеПараметрамиСЕСервер.ПеренестиЗначенияСвойств(ТекущийОбъект.Ссылка, РеквизитФормыВЗначение("ДеревоПараметров"));
	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	СтруктурныеЕдиницы.Ссылка
		|ИЗ
		|	Справочник.СтруктурныеЕдиницы КАК СтруктурныеЕдиницы
		|ГДЕ
		|	СтруктурныеЕдиницы.Родитель = &Родитель";

	Запрос.УстановитьПараметр("Родитель", ТекущийОбъект.Ссылка);

	Результат = Запрос.Выполнить();

	ВыборкаДетальныеЗаписи = Результат.Выбрать();

	path = УправлениеПараметрамиСЕСервер.ПолучитьЗначениеСвойства(ПланыВидовХарактеристик.ПараметрыСтруктурныхЕдиниц.ПутьПубликацииВебСервисов,ТекущийОбъект.Ссылка);
	user = УправлениеПараметрамиСЕСервер.ПолучитьЗначениеСвойства(ПланыВидовХарактеристик.ПараметрыСтруктурныхЕдиниц.ПользовательВебСервисов,ТекущийОбъект.Ссылка);
	pass = УправлениеПараметрамиСЕСервер.ПолучитьЗначениеСвойства(ПланыВидовХарактеристик.ПараметрыСтруктурныхЕдиниц.ПарольВебСервисов,ТекущийОбъект.Ссылка);
	ПутьПубликацииВебСервисов = ПланыВидовХарактеристик.ПараметрыСтруктурныхЕдиниц.ПутьПубликацииВебСервисов;
	ПользовательВебСервисов = ПланыВидовХарактеристик.ПараметрыСтруктурныхЕдиниц.ПользовательВебСервисов;
	ПарольВебСервисов = ПланыВидовХарактеристик.ПараметрыСтруктурныхЕдиниц.ПарольВебСервисов;
	Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
		Запись = РегистрыСведений.ПараметрыСтруктурныхЕдиниц.СоздатьМенеджерЗаписи();
		Запись.Свойство = ПутьПубликацииВебСервисов;
		Запись.Значение = path;
		Запись.Представление = path;
		Запись.СтруктурнаяЕдиница = ВыборкаДетальныеЗаписи.Ссылка;
		Запись.Записать();
		Запись = РегистрыСведений.ПараметрыСтруктурныхЕдиниц.СоздатьМенеджерЗаписи();
		Запись.Свойство = ПользовательВебСервисов;
		Запись.Значение = user;
		Запись.Представление = user;
		Запись.СтруктурнаяЕдиница = ВыборкаДетальныеЗаписи.Ссылка;
		Запись.Записать();
		Запись = РегистрыСведений.ПараметрыСтруктурныхЕдиниц.СоздатьМенеджерЗаписи();
		Запись.Свойство = ПарольВебСервисов;
		Запись.Значение = pass;
		Если ЗначениеЗаполнено(Запись.Значение) Тогда
			Запись.Представление = "**********";
		КонецЕсли;	
		Запись.СтруктурнаяЕдиница = ВыборкаДетальныеЗаписи.Ссылка;
		Запись.Записать();
	КонецЦикла;
КонецПроцедуры

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	Дерево = УправлениеПараметрамиСЕСервер.ЗаполнитьДеревоПараметров(Объект.Ссылка);
	ЗначениеВДанныеФормы(Дерево,ДеревоПараметров);
	ВебСервисSMS = ПланыВидовХарактеристик.ПараметрыСтруктурныхЕдиниц.ВебСервисSMS;
	ФлагВебСервисSMSСтрока = ТипЗнч(Дерево.Строки.Найти(ВебСервисSMS,,Истина).Значение) = Тип("Строка");
КонецПроцедуры

&НаСервере
Процедура ПередЗаписьюНаСервере(Отказ, ТекущийОбъект, ПараметрыЗаписи)
	Код = 0;
КонецПроцедуры

&НаКлиенте
Процедура ДеревоПараметровПриОкончанииРедактирования(Элемент, НоваяСтрока, ОтменаРедактирования)
	Если Элементы.ДеревоПараметров.ТекущиеДанные.Свойство = ВебСервисSMS Тогда
		ФлагВебСервисSMSСтрока = ПолучитьФлагВебСервисSMSСтрока();
	КонецЕсли;	
КонецПроцедуры

&НаСервере
Функция ПолучитьФлагВебСервисSMSСтрока()
	Возврат ТипЗнч(ДанныеФормыВЗначение(ДеревоПараметров,Тип("ДеревоЗначений")).Строки.Найти(ВебСервисSMS,,Истина).Значение) = Тип("Строка");
КонецФункции

