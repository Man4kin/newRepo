
&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	Если Параметры.Отбор.Количество() = 0 Тогда
		ОбщегоНазначенияКлиентСервер.УстановитьЭлементОтбораДинамическогоСписка(
			Список, "Владелец", ПолучитьМассивТекущихСтруктурныхЕдиниц(),
			ВидСравненияКомпоновкиДанных.ВСписке, , ,
			РежимОтображенияЭлементаНастройкиКомпоновкиДанных.БыстрыйДоступ);
	КонецЕсли;
	
КонецПроцедуры

&НаСервере
Функция ПолучитьМассивТекущихСтруктурныхЕдиниц()

	мВладельцы = Новый Массив;
	мВладельцы.Добавить(Справочники.СтруктурныеЕдиницы.ПустаяСсылка());	//временно
	Если ПараметрыСеанса.ТекущаяСтруктурнаяЕдиница.ЭтоГруппа Тогда
		Запрос = Новый Запрос;
		Запрос.УстановитьПараметр("Ссылка", ПараметрыСеанса.ТекущаяСтруктурнаяЕдиница);
		Запрос.Текст = "ВЫБРАТЬ
		               |	СтруктурныеЕдиницы.Ссылка
		               |ИЗ
		               |	Справочник.СтруктурныеЕдиницы КАК СтруктурныеЕдиницы
		               |ГДЕ
		               |	СтруктурныеЕдиницы.Ссылка В ИЕРАРХИИ(&Ссылка)";
		Выборка = Запрос.Выполнить().Выбрать();
		Пока Выборка.Сбросить() Цикл
			мВладельцы.Добавить(Выборка.Ссылка);
		КонецЦикла;
	Иначе
		мВладельцы.Добавить(ПараметрыСеанса.ТекущаяСтруктурнаяЕдиница);
	КонецЕсли;
	
	Возврат мВладельцы;
КонецФункции
