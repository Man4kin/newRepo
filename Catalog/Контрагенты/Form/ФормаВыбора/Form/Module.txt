
&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	ОтборПоСвязиСФирмой = Параметры.ОтборПоСвязиСФирмой;
	
	Если НЕ Параметры.Фирма.Пустая() И ОтборПоСвязиСФирмой Тогда
		Список.ПроизвольныйЗапрос = Истина;
		//ШиловМВ 04.06.14 №000117948
		Список.ТекстЗапроса = "ВЫБРАТЬ
		|	Контрагенты.Наименование,
		|	Контрагенты.Код,
		|	Контрагенты.ИНН,
		|	Контрагенты.Ссылка
		|ИЗ
		|	Справочник.Контрагенты КАК Контрагенты
		|ГДЕ
		|	ВЫБОР
		|			КОГДА Контрагенты.ЭтоГруппа
		|				ТОГДА ИСТИНА
		|			ИНАЧЕ Контрагенты.Ссылка В
		|					(ВЫБРАТЬ
		|						СвязьФирмИКонтрагентов.Контрагент.Ссылка
		|					ИЗ
		|						РегистрСведений.СвязьФирмИКонтрагентов КАК СвязьФирмИКонтрагентов
		|					ГДЕ
		|						СвязьФирмИКонтрагентов.Фирма = &Фирма)
		|		КОНЕЦ
		//++БИТ БВО 2015-10-30 Необходимо выбирать только активных контрагентов
		| И Контрагенты.Статус
		|"
		//--БИТ БВО 2015-10-30
		//{МининНА 2014-07-24 01:00:43 Наряд № 000122251 
		+ ?(Константы.ИспользоватьПодразделенияПоставщиков.Получить() и ПараметрыСеанса.ТекущаяСтруктурнаяЕдиница.ТипСтруктурнойЕдиницы = Перечисления.ТипыСтруктурныхЕдиниц.Склад,"	И Контрагенты.ПротоколРЦ","");
		//МининНА 2014-07-24 01:00:43 Наряд № 000122251} 
		//ШиловМВ 04.06.14
		Список.Параметры.УстановитьЗначениеПараметра("Фирма",Параметры.Фирма);
		Список.ОсновнаяТаблица = "Справочник.Контрагенты";
	//{МининНА 2014-07-24 01:00:43 Наряд № 000122251 
	ИначеЕсли Константы.ИспользоватьПодразделенияПоставщиков.Получить() и ПараметрыСеанса.ТекущаяСтруктурнаяЕдиница.ТипСтруктурнойЕдиницы = Перечисления.ТипыСтруктурныхЕдиниц.Склад Тогда 
		ЭО=Список.Отбор.Элементы.Добавить(Тип("ЭлементОтбораКомпоновкиДанных"));
		ЭО.ВидСравнения=ВидСравненияКомпоновкиДанных.Равно;
		ЭО.ЛевоеЗначение=Новый ПолеКомпоновкиДанных("ПротоколРЦ");
		ЭО.ПравоеЗначение=Истина;
		ЭО.Использование=Истина;
	//МининНА 2014-07-24 01:00:43 Наряд № 000122251} 	
	КонецЕсли;									  
КонецПроцедуры