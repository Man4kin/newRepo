
&НаКлиенте
Процедура ОбработкаКоманды(ПараметрКоманды, ПараметрыВыполненияКоманды)
	Если ПроверкаКлиента(ПараметрКоманды) = Ложь Тогда
		Возврат;
	КонецЕсли;	
	ПараметрыФормы = Новый Структура("Поставщик",ПараметрКоманды);
	ОткрытьФорму("БизнесПроцесс.АвтоЗаказ.ФормаСписка", ПараметрыФормы, ПараметрыВыполненияКоманды.Источник, ПараметрыВыполненияКоманды.Уникальность, ПараметрыВыполненияКоманды.Окно);
КонецПроцедуры

&НаСервере
Функция ПроверкаКлиента(ПараметрКоманды)
	Если ТипЗнч(ПараметрКоманды) = Тип("СправочникСсылка.СтруктурныеЕдиницы") Тогда
		Если СтруктурныеЕдиницы.ПринадлежитГруппеСЕ(ПараметрКоманды,ПараметрыСеанса.ТекущаяСтруктурнаяЕдиница) Тогда
			ОбщегоНазначенияКлиентСервер.СообщитьПользователю("Автозаказ не оформляется для текущей структурной единицы!");
			Возврат Ложь;
		КонецЕсли;	
		Если НЕ ПараметрКоманды = Справочники.СтруктурныеЕдиницы.Центр Тогда
			Запрос = Новый Запрос;
			Запрос.Текст = 
				"ВЫБРАТЬ
				|	Склады.Ссылка
				|ИЗ
				|	Справочник.Склады КАК Склады
				|ГДЕ
				|	Склады.Владелец = &Владелец
				|	И Склады.ВидСклада = &ВидСклада";

			Запрос.УстановитьПараметр("ВидСклада", Перечисления.ВидыСкладов.Производство);
			Запрос.УстановитьПараметр("Владелец", ПараметрКоманды);

			Результат = Запрос.Выполнить();
			Если Результат.Пустой() Тогда
				ОбщегоНазначенияКлиентСервер.СообщитьПользователю("Автозаказ оформляется только для структурной единицы ""Центр"" или для производств!");
				Возврат Ложь;
			КонецЕсли;	
		КонецЕсли;	
	КонецЕсли;
	Возврат Истина;
КонецФункции
