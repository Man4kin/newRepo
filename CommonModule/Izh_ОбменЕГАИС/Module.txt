Функция ПолучитьНомерДокументаИзТТН(НаименованиеФайла)
	Возврат Сред(НаименованиеФайла, 3, Найти(НаименованиеФайла, "_") - 3);
КонецФункции

Процедура ЗагрузкаТТН() Экспорт
	КаталогОбмена = "K:\Exchange\ЕГАИС\";
	НайденныеФайлы = НайтиФайлы(КаталогОбмена, "wb*.xml");
	
	НомераДокументовТТН = Новый Массив;
	СоответствиеНомеровДокументовСФайлом = Новый Соответствие; 
	Для Каждого Файл Из НайденныеФайлы Цикл
		НомерДокумента = ПолучитьНомерДокументаИзТТН(Файл.ИмяБезРасширения);
		НомераДокументовТТН.Добавить(НомерДокумента);
		СоответствиеНомеровДокументовСФайлом.Вставить(НомерДокумента, Файл); 
	КонецЦикла;
	
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ
					|	ПриложениеПоАлкоголю.Ссылка,
	               |	ПриложениеПоАлкоголю.НомерДокумента
	               |ИЗ
	               |	Документ.ПриложениеПоАлкоголю КАК ПриложениеПоАлкоголю
	               |ГДЕ
	               |	ПриложениеПоАлкоголю.СтатусЕГАИС = ЗНАЧЕНИЕ(Перечисление.СтатусыЕГАИС.НеЗагруженИзЕГАИС)
				   |	И ПриложениеПоАлкоголю.НомерДокумента В (&НомераДокументовТТН)";
	Запрос.УстановитьПараметр("НомераДокументовТТН", НомераДокументовТТН);
	РезультатЗапроса = Запрос.Выполнить().Выбрать();
	//Пока РезультатЗапроса.Следующий() Цикл
		//ФайлXML = СоответствиеНомеровДокументовСФайлом[РезультатЗапроса.НомерДокумента];
		ФайлXML = СоответствиеНомеровДокументовСФайлом["32412"];
		
		ТЗСоставТТН = Новый ТаблицаЗначений;
		ТЗСоставТТН.Колонки.Добавить("АлкоКод");
		ТЗСоставТТН.Колонки.Добавить("КоличествоПоставщика");
		ТЗСоставТТН.Колонки.Добавить("НомерПартии");
		
		Чтение = Новый ЧтениеXML;
		Чтение.ОткрытьФайл(ФайлXML.ПолноеИмя);
		Пока Чтение.Прочитать() Цикл
			Если Чтение.ТипУзла = ТипУзлаXML.НачалоЭлемента Тогда
				
				Если Чтение.Имя = "wb:Quantity" Тогда
					Чтение.Прочитать();
					Если Чтение.ТипУзла = ТипУзлаXML.Текст Тогда
						Сообщить("Количество " + Чтение.Значение);
						КоличествоПоставщика = Чтение.Значение;
					КонецЕсли;	
				КонецЕсли;	
				
				Если Чтение.Имя = "pref:BRegId" Тогда
					Чтение.Прочитать();
					Если Чтение.ТипУзла = ТипУзлаXML.Текст Тогда
						Сообщить("НомерПартии " + Чтение.Значение);
						НомерПартии = Чтение.Значение; 
					КонецЕсли;	
				КонецЕсли;	
				
				
				Если Чтение.Имя = "pref:AlcCode" Тогда
					Чтение.Прочитать();
					Если Чтение.ТипУзла = ТипУзлаXML.Текст Тогда
						Сообщить("АлкоКод " + Чтение.Значение);
						АлкоКод =  Чтение.Значение;
					КонецЕсли;
					СтрТЗСоставТТН = ТЗСоставТТН.Добавить();
					СтрТЗСоставТТН.АлкоКод = АлкоКод;
					СтрТЗСоставТТН.КоличествоПоставщика = КоличествоПоставщика;
					СтрТЗСоставТТН.НомерПартии = НомерПартии;
				КонецЕсли;
				
			КонецЕсли;		
		КонецЦикла;
		
		
		
	//КонецЦикла;	
КонецПроцедуры	