Процедура ЗапускБПАвтоЗаказ(БизнесПроцесс) Экспорт
	Если БизнесПроцесс.ПометкаУдаления Тогда
		ВызватьИсключение("Объект удален!");
		Возврат;
	КонецЕсли;	
	Если НЕ БизнесПроцесс.Стартован Тогда
		Объект = БизнесПроцесс.ПолучитьОбъект();
		Попытка
			Объект.Старт();
		Исключение
			ВызватьИсключение(ОписаниеОшибки());
		КонецПопытки;	
	КонецЕсли;	
КонецПроцедуры	

Процедура АвтоЗакрытиеЗаказа() Экспорт
	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	ЗаказыИсходящиеОстатки.ПоДокументу
		|ИЗ
		|	РегистрНакопления.ЗаказыИсходящие.Остатки КАК ЗаказыИсходящиеОстатки
		|		ЛЕВОЕ СОЕДИНЕНИЕ Документ.ПриходнаяНакладная КАК ПриходнаяНакладная
		|		ПО ЗаказыИсходящиеОстатки.ПоДокументу = ПриходнаяНакладная.ДокОснование
		|			И (ПриходнаяНакладная.Проведен)
		|ГДЕ
		|	ЗаказыИсходящиеОстатки.КоличествоОстаток > 0
		|	И ВЫБОР
		|			КОГДА ПриходнаяНакладная.Ссылка ЕСТЬ NULL 
		|				ТОГДА ЗаказыИсходящиеОстатки.ПоДокументу.ДатаПоставкиДо < &ТекущаяДата
		|			ИНАЧЕ ИСТИНА
		|		КОНЕЦ";

	Запрос.УстановитьПараметр("ТекущаяДата", НачалоДня(ТекущаяДата()));

	Результат = Запрос.Выполнить();

	ВыборкаДетальныеЗаписи = Результат.Выбрать();

	Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
		ЗакрытиеЗаказа = Документы.ЗакрытиеЗаказа.СоздатьДокумент();
		ЗакрытиеЗаказа.ИнициализироватьДокумент();
		ЗакрытиеЗаказа.Дата = ТекущаяДата();
		ЗакрытиеЗаказа.ДокОснование = ВыборкаДетальныеЗаписи.ПоДокументу;
		ЗакрытиеЗаказа.Записать(РежимЗаписиДокумента.Проведение);
	КонецЦикла;
КонецПроцедуры	

&НаСервере
Функция ПолучитьАртикул(Контрагент,Номенклатура) Экспорт
	Артикул = "";
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ
	               |	НоменклатураКонтрагента.Артикул
	               |ИЗ
	               |	РегистрСведений.НоменклатураКонтрагента КАК НоменклатураКонтрагента
	               |ГДЕ
	               |	НоменклатураКонтрагента.Номенклатура = &Номенклатура
	               |	И НоменклатураКонтрагента.Контрагент = &Контрагент";
	Запрос.УстановитьПараметр("Контрагент",Контрагент);
	Запрос.УстановитьПараметр("Номенклатура",Номенклатура);
	Рез = Запрос.Выполнить();
	Выборка = Рез.Выбрать();
	Пока Выборка.Следующий() Цикл
		Артикул = Выборка.Артикул;   
	КонецЦикла;
	Возврат Артикул;
КонецФункции

