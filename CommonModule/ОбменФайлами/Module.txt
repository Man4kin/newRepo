////////////////////////////////////////////////////////////////////////////////
// ЭКСПОРТНЫЕ ВНЕШНИЕ ПРОЦЕДУРЫ И ФУНКЦИИ



// Создать файловый начальный образ на сервере
Функция СоздатьФайловыйНачальныйОбразНаСервере(Узел, УникальныйИдентификаторФормы, Язык, ПолноеИмяФайловойБазы,Ошибка) Экспорт
	
	// создать временный каталог
	ИмяКаталога = ПолучитьИмяВременногоФайла();
	СоздатьКаталог(ИмяКаталога);
	
	// создать временный каталог для файлов
	ИмяКаталогаФайлов = ПолучитьИмяВременногоФайла();
	СоздатьКаталог(ИмяКаталогаФайлов);
	
	ХранилищеОбщихНастроек.Сохранить("ОбменФайлами", "ВременныйКаталог", ИмяКаталогаФайлов);
	
	//ZIP = Неопределено;
	//Запись = Неопределено;
	
	Попытка
		
		СтрокаСоединения = "File=""" + ПолноеИмяФайловойБазы + """;" 
						 + "Locale=""" + Язык + """;";
		ПланыОбмена.СоздатьНачальныйОбраз(Узел, СтрокаСоединения);  // собственно создание начального образа
		
		//ZIP = Новый ЗаписьZipФайла(ПутьФайла);
		////ПутьZIP = ПутьФайла;
		////ZIP.Открыть(ПутьZIP);
		//
		//ВременныеФайлы = Новый Массив;
		//ВременныеФайлы = НайтиФайлы(ИмяКаталога, "*.*");
		//
		//Для Каждого ВременныйФайл Из ВременныеФайлы Цикл
		//	Если ВременныйФайл.ЭтоФайл() Тогда
		//		ПутьВременногоФайла = ВременныйФайл.ПолноеИмя;
		//		ZIP.Добавить(ПутьВременногоФайла);
		//	КонецЕсли;
		//КонецЦикла;
		//
		//ZIP.Записать();
		//
		//УдалитьФайлы(ИмяКаталогаФайлов); // удаляем вместе с файлами внутри
		
	Исключение
		
		//УдалитьФайлы(ИмяКаталога);
		Ошибка = ОписаниеОшибки();
		
		Возврат Ложь;
	КонецПопытки;
	
	//ПутьВременногоФайлаБазы = ИмяКаталога + "\1Cv8.1CD";
	//ПереместитьФайл(ПутьВременногоФайлаБазы, ПолноеИмяФайловойБазы);
	//
	//// очистка
	//УдалитьФайлы(ИмяКаталога);
	
	Возврат Истина;
КонецФункции

// Создать серверный начальный образ на сервере
Функция СоздатьСерверныйНачальныйОбразНаСервере(Узел, СтрокаСоединения,Ошибка) Экспорт
	
	// создать временный каталог
	ИмяКаталога = ПолучитьИмяВременногоФайла();
	СоздатьКаталог(ИмяКаталога);
	
	// создать временный каталог для файлов
	ИмяКаталогаФайлов = ПолучитьИмяВременногоФайла();
	СоздатьКаталог(ИмяКаталогаФайлов);
	
	ХранилищеОбщихНастроек.Сохранить("ОбменФайлами", "ВременныйКаталог", ИмяКаталогаФайлов);
	
	//ZIP = Неопределено;
	//Запись = Неопределено;
	
	Попытка
		
		ПланыОбмена.СоздатьНачальныйОбраз(Узел, СтрокаСоединения);
		
		//ZIP = Новый ЗаписьZipФайла;
		//ПутьZIP = ПутьФайла;
		//ZIP.Открыть(ПутьZIP);
		//
		//ВременныеФайлы = Новый Массив;
		//ВременныеФайлы = НайтиФайлы(ИмяКаталогаФайлов, "*.*");
		//
		//Для Каждого ВременныйФайл Из ВременныеФайлы Цикл
		//	Если ВременныйФайл.ЭтоФайл() Тогда
		//		ПутьВременногоФайла = ВременныйФайл.ПолноеИмя;
		//		ZIP.Добавить(ПутьВременногоФайла);
		//	КонецЕсли;
		//КонецЦикла;
		//
		//ZIP.Записать();
		УдалитьФайлы(ИмяКаталогаФайлов); // удаляем вместе с файлами внутри
		
	Исключение
		
		УдалитьФайлы(ИмяКаталога);
		ВызватьИсключение;
		
	КонецПопытки;
	
	// очистка
	УдалитьФайлы(ИмяКаталога);
	
	Возврат Истина;
КонецФункции
