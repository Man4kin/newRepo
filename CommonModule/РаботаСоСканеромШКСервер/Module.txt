Функция ПолучитьНоменклатуру(ШК,СтруктураПодбора,СтрокаСообщения) Экспорт
	
	сткДанныеПоШК = ШтриховыеКоды.ПрочитатьШтрихкод(ШК);
	//сткДанныеПоШК = Новый Структура("мНоменклатура, мВес", мНоменклатура, мВес)
	//товара и вес соответствуют по индексу
	мНоменклатура = сткДанныеПоШК.мНоменклатура;
	
	Если мНоменклатура.Количество() = 0 Тогда
		//СтрокаСообщения = НСтр("ru = 'Данные по штрихкоду не найдены: %1%'");
		Возврат Неопределено;
	Иначе
		Если СтруктураПодбора <> Неопределено Тогда
			Запрос = Новый Запрос;
			Запрос.Текст = "ВЫБРАТЬ
			|		тНоменклатура.Ссылка
			|	ИЗ
			|		Справочник.Номенклатура КАК тНоменклатура
			|		Внутреннее соединение ("+СтруктураПодбора.ТекстЗапроса+") КАК Подбор ПО Подбор.Код = тНоменклатура.Код
			|	ГДЕ
			|		тНоменклатура.Ссылка В (&СписокНоменклатуры)";
			Запрос.УстановитьПараметр("СписокНоменклатуры", мНоменклатура);
			Для Каждого Параметр Из СтруктураПодбора.Параметры.Элементы Цикл
				Запрос.УстановитьПараметр(Строка(Параметр.Параметр),Параметр.Значение);
			КонецЦикла;
			
			Результат = Запрос.Выполнить();
			Если Результат.Пустой() Тогда
				СтрокаСообщения = НСтр("ru = 'Товар не может быть добавлен в документ! %1%'");
				Возврат Неопределено;
			Иначе
				мНоменклатура = Результат.Выгрузить().ВыгрузитьКолонку("Ссылка");
				мВес = Новый Массив;
				Выборка = Результат.Выбрать();
				Пока Выборка.Следующий() Цикл
					инд = сткДанныеПоШК.мНоменклатура.Найти(Выборка.Ссылка);
					Если Не инд = Неопределено Тогда
						мВес.Добавить(сткДанныеПоШК.мВес[инд]);
					КонецЕсли;
				КонецЦикла;
				сткДанныеПоШК.мНоменклатура = мНоменклатура;
				сткДанныеПоШК.мВес = мВес;
			КонецЕсли;	
		КонецЕсли;	
		//Возврат ПоместитьВоВременноеХранилище(мНоменклатура, ПараметрыСеанса.ТекущийПользователь.УникальныйИдентификатор());
		Возврат сткДанныеПоШК;
	КонецЕсли;
КонецФункции	

Функция ПолучитьСтруктуруЗапросаПодбора(ДинамическийСписок) Экспорт
	СтруктураПодбора = Новый Структура;
	СтруктураПодбора.Вставить("ТекстЗапроса",Строка(ДинамическийСписок.ТекстЗапроса));
	СтруктураПодбора.Вставить("Параметры",ДинамическийСписок.Параметры);
	Возврат СтруктураПодбора;
КонецФункции	

Функция ПолучитьДокумент(Данные,ЗначениеОтбора,СтрокаСообщения) экспорт	
	ВидДокумента = ЗначениеОтбора.Ссылка.Значение.Метаданные().Имя;
	Попытка
		ПромСсылка = Документы[ВидДокумента].ПолучитьСсылку(Новый УникальныйИдентификатор(Данные));
	Исключение
		СтрокаСообщения = НСтр("ru = 'Документа с таким кодом не существует!'");
		Возврат Неопределено;
	КонецПопытки;
	ДокОбъект = ПромСсылка.ПолучитьОбъект();
	Если ДокОбъект = Неопределено Тогда
		СтрокаСообщения = НСтр("ru = 'Документа с таким кодом не существует!'");
		Возврат Неопределено;			
	КонецЕсли;	
	Возврат ПоместитьВоВременноеХранилище(ДокОбъект, ПараметрыСеанса.ТекущийПользователь.УникальныйИдентификатор());
КонецФункции