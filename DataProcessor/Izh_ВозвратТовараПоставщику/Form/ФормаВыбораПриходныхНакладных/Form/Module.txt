//++Минин
&НаКлиенте
Процедура ПодборПриходныхНакладных(Команда)
	ФормаПодбора = ПолучитьФорму("Обработка.Izh_ВозвратТовараПоставщику.Форма.ФормаПодбора",Новый Структура("ЗакрыватьПриВыборе",Ложь),ЭтаФорма);
	ФормаПодбора.ЗакрыватьПриВыборе = Ложь;
	ФормаПодбора.Открыть();	
	//ОткрытьФорму("Обработка.Izh_ВозвратТовараПоставщику.Форма.ФормаПодбора",Новый Структура("ЗакрыватьПриВыборе",Ложь),ЭтаФорма);
КонецПроцедуры

&НаКлиенте
Процедура ОбработкаВыбора(ВыбранноеЗначение, ИсточникВыбора)
	Массив = ТЗПриходныеНакладные.НайтиСтроки(Новый Структура("ПриходнаяНакладная",ВыбранноеЗначение));
	Если Массив.Количество() = 0 Тогда 
		Строка = ТЗПриходныеНакладные.Добавить();
		Строка.ПриходнаяНакладная = ВыбранноеЗначение;
	КонецЕсли;
КонецПроцедуры

&НаКлиенте
Процедура ВыборНоменклатуры(Команда)
	ВыборНоменклатурыНаСервере();
	ОповеститьОВыборе(ТЗНоменклатура);
КонецПроцедуры

&НаСервере
Процедура ВыборНоменклатурыНаСервере()
	
	//++БИТ БВО
	//Массив = ТЗПриходныеНакладные.Выгрузить();	
	//
	//Запрос = Новый Запрос;
	//Запрос.Текст = "ВЫБРАТЬ
	//|	ПриходнаяНакладнаяСостав.Номенклатура,
	//|	СУММА(ПриходнаяНакладнаяСостав.Количество) КАК Количество
	//|ИЗ
	//|	Документ.ПриходнаяНакладная.Состав КАК ПриходнаяНакладнаяСостав
	//|ГДЕ
	//|	ПриходнаяНакладнаяСостав.Ссылка В(&Список)
	//|
	//|СГРУППИРОВАТЬ ПО
	//|	ПриходнаяНакладнаяСостав.Номенклатура";
	//Запрос.УстановитьПараметр("Список",Массив.ВыгрузитьКолонку("ПриходнаяНакладная"));
	//Результат = Запрос.Выполнить().Выгрузить();
	//
	//ТЗНоменклатура.Загрузить(Результат);
	ОбъектОбработка = РеквизитФормыВЗначение("Объект");
	
	ТаблицаДокументов = Новый ТаблицаЗначений;	
	ТаблицаДокументов.Колонки.Добавить("Ссылка"					, Новый ОписаниеТипов("ДокументСсылка.РасходнаяНакладная, ДокументСсылка.ПриходнаяНакладная, ДокументСсылка.КорректировкаРеализации, ДокументСсылка.КорректировкаПоступления, ДокументСсылка.ПередачаТоваровМеждуФирмами"));
	ТаблицаДокументов.Колонки.Добавить("ТипДокумента"			, Новый ОписаниеТипов("Тип"));	
	ТаблицаДокументов.Колонки.Добавить("ДокОснование"			, Новый ОписаниеТипов("ДокументСсылка.РасходнаяНакладная, ДокументСсылка.ПриходнаяНакладная, ДокументСсылка.КорректировкаРеализации, ДокументСсылка.КорректировкаПоступления, ДокументСсылка.ПередачаТоваровМеждуФирмами"));
	ТаблицаДокументов.Колонки.Добавить("ПоследнийДокВЦепочке"	, Новый ОписаниеТипов("Булево"));	
	
	ТаблицаОстатков = Новый ТаблицаЗначений;		
	ТаблицаОстатков.Колонки.Добавить("Номенклатура"	, Новый ОписаниеТипов("СправочникСсылка.Номенклатура"));	
	ТаблицаОстатков.Колонки.Добавить("Количество"	, Новый ОписаниеТипов("Число"));	
	
	Для Каждого СтрокаНакладной ИЗ ТЗПриходныеНакладные Цикл		
		ТаблицаДокументов.Очистить();		
		ДокументПриходная = СтрокаНакладной.ПриходнаяНакладная;				
		ОбъектОбработка.ПолучитьКонечныеОстаткиПоДокументу(ДокументПриходная, ТаблицаДокументов, ТаблицаОстатков);				
	КонецЦикла;	
	
	ТаблицаОстатков.Свернуть("Номенклатура", "Количество"); 
	ТЗНоменклатура.Загрузить(ТаблицаОстатков);
	//--БИТ БВО	
	
КонецПроцедуры
//--Минин