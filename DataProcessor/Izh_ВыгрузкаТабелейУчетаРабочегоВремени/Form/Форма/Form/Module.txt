&НаСервере
Функция ПолучитьМассивПриставок()
	
	МассивПриставок = Новый Массив(4);
	МассивПриставок[0] = "Первый";
	МассивПриставок[1] = "Второй";
	МассивПриставок[2] = "Третий";
	МассивПриставок[3] = "Четвертый";
	
	Возврат МассивПриставок;
	
КонецФункции

&НаСервере
Функция ВыгрузитьДокументыНаСервере(ТекстДокумента = "")
	
	ЭтаОбработка = РеквизитФормыВЗначение("Объект");
	ТабТабелей = РеквизитФормыВЗначение("ВыгружаемыеДокументы");
	ТабТабелей.Свернуть("ДокументТабель");
	МассивТабелей = ТабТабелей.ВыгрузитьКолонку("ДокументТабель");
	
	Если МассивТабелей.Количество() = 0 Тогда
		АдресХранилища = "Не выбрано ни одного табеля для выгрузки.";
		Возврат Ложь;
	КонецЕсли;
	
	Если ЭтаОбработка.ПолучитьТекстВыгрузки(МассивТабелей, ТекстДокумента) Тогда
		Попытка		
			ЗначениеВРеквизитФормы(ЭтаОбработка, "Объект");
			Возврат Истина;
		Исключение
			АдресХранилища = ОписаниеОшибки();
			Возврат Ложь;
		КонецПопытки;
	Иначе
		АдресХранилища = ТекстДокумента;
		Возврат Ложь;
	КонецЕсли;	
	
КонецФункции

&НаКлиенте
Процедура ВыгрузитьДокументы(Команда)
	
	ТекстДокумента = "";
	Если ВыгрузитьДокументыНаСервере(ТекстДокумента) Тогда
		Объект.ТДок.УстановитьТекст(ТекстДокумента);	
		Попытка
			Объект.ТДок.Записать(ПутьКФайлуВыгрузки);	
			Сообщить("Данные успешно записаны в файл " + """" + ПутьКФайлуВыгрузки + """");
		Исключение
			Сообщить("Не удалось записать в файл " + """" + ПутьКФайлуВыгрузки + """");
		КонецПопытки;
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура ФайлВыгрузкиНачалоВыбора(Элемент, ДанныеВыбора, СтандартнаяОбработка)
	
	ДВФ = Новый ДиалогВыбораФайла(РежимДиалогаВыбораФайла.Сохранение);
	ДВФ.Фильтр = "Текстовые документы (*.txt)|*.txt";
	Если ДВФ.Выбрать() Тогда
		ПутьКФайлуВыгрузки = ДВФ.ПолноеИмяФайла;		
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура ФайлВыгрузкиОткрытие(Элемент, СтандартнаяОбработка)
	
	СтандартнаяОбработка = Ложь;
	ЗапуститьПриложение(ПутьКФайлуВыгрузки);
	
КонецПроцедуры
