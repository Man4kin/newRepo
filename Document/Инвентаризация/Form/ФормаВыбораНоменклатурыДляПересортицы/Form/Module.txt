

&НаКлиенте
Процедура ПриОткрытии(Отказ)
	ЗакрыватьПриВыборе = Истина;
	ЗаполнитьТЗ();
	Если тз.Количество() = 0 Тогда
		Если флНедостачиИзлишки Тогда
			Предупреждение("Излишки не обнаружены!");
		Иначе
			Предупреждение("Недостачи не обнаружены!");
		КонецЕсли;
		Отказ = Истина;
	КонецЕСли;
КонецПроцедуры


&НаКлиенте
Процедура ЗаполнитьТЗ()
	
	мсв =  ВладелецФормы.Объект.Состав.НайтиСтроки(Новый Структура("Склад",Склад));
	Для каждого Эл из мсв Цикл
		Если (флНедостачиИзлишки И (Эл.Количество > Эл.КоличествоУчет)) ИЛИ (НЕ флНедостачиИзлишки И (Эл.Количество < Эл.КоличествоУчет)) Тогда
			СтрокаТз = тз.Добавить();
			СтрокаТз.Номенклатура   = Эл.Номенклатура;
			СтрокаТз.Количество     = Эл.Количество;
			СтрокаТз.КоличествоУчет = Эл.КоличествоУчет;
			СтрокаТз.Разница        = Эл.Количество - Эл.КоличествоУчет;
		КонецЕсли;
	КонецЦикла;	
		
	
КонецПроцедуры	

&НаКлиенте
Процедура тзВыбор(Элемент, ВыбраннаяСтрока, Поле, СтандартнаяОбработка)
	Закрыть(Новый Структура("Номенклатура,Количество",тз[ВыбраннаяСтрока].Номенклатура,тз[ВыбраннаяСтрока].Разница));
КонецПроцедуры





