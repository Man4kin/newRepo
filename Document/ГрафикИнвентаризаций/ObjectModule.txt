
Процедура ПриКопировании(ОбъектКопирования)
	Автор = ПараметрыСеанса.ТекущийПользователь;
	ДатаИнвентаризации = "";
	НомерRMS = 0;
КонецПроцедуры

Процедура ПередЗаписью(Отказ, РежимЗаписи, РежимПроведения)
	//Если НЕ ЭтотОбъект.ЭтоНовый() Тогда
	//	Отказ = РаботаСФормамиСервер.ЗапрещеноРедактировать(ЭтотОбъект.Ссылка);
	//	Если Отказ Тогда
	//		Возврат;
	//	КонецЕсли;
	//КонецЕсли;	
КонецПроцедуры

Процедура ОбработкаЗаполнения(ДанныеЗаполнения, СтандартнаяОбработка)
	ИнициализироватьДокумент();
КонецПроцедуры

Процедура ИнициализироватьДокумент()
	Автор = ПараметрыСеанса.ТекущийПользователь;
	
	Если НЕ ЗначениеЗаполнено(СтруктурнаяЕдиница) И НЕ ПараметрыСеанса.ТекущаяСтруктурнаяЕдиница.ЭтоГруппа Тогда
		СтруктурнаяЕдиница = ПараметрыСеанса.ТекущаяСтруктурнаяЕдиница;
	КонецЕсли;
	ДатаИнвентаризации = НачалоДня(ТекущаяДата());
	//ДатаИнвентаризации = НачалоДня(ТекущаяДата())+24*3600;
КонецПроцедуры


Процедура ОбработкаПроведения(Отказ, РежимПроведения)
	Если Не Отказ тогда
		струкПараметры = Новый Структура;
		струкПараметры.Вставить("БизнесПроцесс", БизнесПроцессы.ПроведениеИнвентаризации);
		струкПараметры.Вставить("Основание", ЭтотОбъект.Ссылка);
		струкПараметры.Вставить("Удалять", Истина); 
		струкПараметры.Вставить("Искать", Истина);
		УправлениеБизнесПроцессамиСервер.ЗапуститьБизнесПроцесс(струкПараметры);
	Конецесли;
КонецПроцедуры


Процедура ОбработкаПроверкиЗаполнения(Отказ, ПроверяемыеРеквизиты)
	Если СтруктурнаяЕдиница.ТипСтруктурнойЕдиницы = Перечисления.ТипыСтруктурныхЕдиниц.Склад Тогда
		Если Склады.Количество() = 0 Тогда
			ОбщегоНазначенияКлиентСервер.СообщитьПользователю(
			НСтр("ru = 'Не заполнена табличная часть Склады.'"), ,
			"Склады", ,
			Отказ);
		КонецЕсли;	
	КонецЕсли;
КонецПроцедуры


Процедура ОбработкаУдаленияПроведения(Отказ)
	БП = УправлениеБизнесПроцессамиСервер.ПоучитьБППоГрафикуИнвентаризации(Ссылка);
	Если БП <> Неопределено Тогда
		Если БП.Завершен Тогда
			Сообщить("Бизнес-процесс уже завершен!");
			Отказ = Истина;
		Иначе
			ТекстОшибки = "";
			Если Не УправлениеБизнесПроцессамиСервер.ЗавершитьБизнесПроцессНаСервере(БП, ТекстОшибки) Тогда
				Сообщить("При аварийном завершении бизнес-процесса произошла ошибка, поэтому завершение отменено.
								|Описание ошибки: " + ТекстОшибки);
				Отказ = Истина;
			КонецЕсли;
		КонецЕсли;	
	КонецЕсли;	
КонецПроцедуры

