 Процедура ПриКопировании(ОбъектКопирования)
	Автор = ПараметрыСеанса.ТекущийПользователь;
КонецПроцедуры


Процедура ОбработкаЗаполнения(ДанныеЗаполнения, СтандартнаяОбработка)
	ИнициализироватьДокумент();
КонецПроцедуры


Процедура ИнициализироватьДокумент()
	Автор = ПараметрыСеанса.ТекущийПользователь;
	Если Не ЗначениеЗаполнено(Валюта) Тогда
		Валюта = СтруктурныеЕдиницы.ПолучитьВалютуТекущейСЕ();
		
		СтруктураКурса = РаботаСКурсамиВалют.ЗаполнитьДанныеКурсаДляВалюты(Валюта);
		Курс = СтруктураКурса.Курс;
		Кратность = СтруктураКурса.Кратность;
	КонецЕсли;
	
	Если НЕ ЗначениеЗаполнено(СтруктурнаяЕдиница) И НЕ ПараметрыСеанса.ТекущаяСтруктурнаяЕдиница.ЭтоГруппа Тогда
		СтруктурнаяЕдиница = ПараметрыСеанса.ТекущаяСтруктурнаяЕдиница;
	КонецЕсли;
	
		
		
КонецПроцедуры

Процедура ОбработкаПроведения(Отказ, РежимПроведения)
	Запрос = Новый Запрос(
	"ВЫБРАТЬ
	|	АвансовыйОтчетСостав.КлассификаторДДС,
	|	СУММА(АвансовыйОтчетСостав.СуммаПоОтчету) КАК Сумма,
	|	АвансовыйОтчетСостав.Ссылка КАК Регистратор,
	|	АвансовыйОтчетСостав.Ссылка.Сотрудник КАК ДенежнаяЯчейка,
	|	АвансовыйОтчетСостав.Ссылка.Дата КАК Период,
	|	АвансовыйОтчетСостав.Ссылка.Фирма КАК Фирма,
	|	&ВидДвижения,
	|	АвансовыйОтчетСостав.Ссылка.Валюта
	|ИЗ
	|	Документ.АвансовыйОтчет.Состав КАК АвансовыйОтчетСостав
	|ГДЕ
	|	АвансовыйОтчетСостав.Ссылка = &Ссылка
	|
	|СГРУППИРОВАТЬ ПО
	|	АвансовыйОтчетСостав.КлассификаторДДС,
	|	АвансовыйОтчетСостав.Ссылка,
	|	АвансовыйОтчетСостав.Ссылка.Сотрудник,
	|	АвансовыйОтчетСостав.Ссылка.Дата,
	|	АвансовыйОтчетСостав.Ссылка.Фирма");
	Запрос.УстановитьПараметр("Ссылка",Ссылка);
	Запрос.УстановитьПараметр("ВидДвижения",ВидДвиженияНакопления.Расход);
	
	ЭтотОбъект.Движения.ДенежныеСредства.Загрузить(Запрос.Выполнить().Выгрузить());
КонецПроцедуры

Процедура ПередЗаписью(Отказ, РежимЗаписи, РежимПроведения)
	ИтогоСумма = Состав.Итог("Сумма");
КонецПроцедуры

Процедура ОбработкаПроверкиЗаполнения(Отказ, ПроверяемыеРеквизиты)
	
	// Сообщим платформе, что мы сами обрабатываем проверку реквизита Аналитика в табличной части Состав
    ПроверяемыйРеквизитАналитика = ПроверяемыеРеквизиты.Найти("Состав.Аналитика");
    Если НЕ ПроверяемыйРеквизитАналитика = Неопределено Тогда
        ПроверяемыеРеквизиты.Удалить(ПроверяемыйРеквизитАналитика);
    КонецЕсли;
	
	// Обходим строки и проверяем заполнение реквизита
	Для Индекс = 1 по Состав.Количество() Цикл
		Индекс0=Индекс-1;
		СтрокаАналитика = Состав.Получить(Индекс0);
		Если Не ЗначениеЗаполнено(СтрокаАналитика.Аналитика) Тогда
			Если НЕ СтрокаАналитика.КлассификаторДДС = ПредопределенноеЗначение("ПланВидовХарактеристик.КлассификаторДДС.ПрочиеВыплатыИПоступления") ИЛИ ЗначениеЗаполнено(СтрокаАналитика.СтатьяДвиженияДенежныхСредств.ТипАналитики) Тогда
				ОбщегоНазначенияКлиентСервер.СообщитьПользователю("В строке " + Индекс + " не заполнено значение Аналитики",ЭтотОбъект,"Состав[" + Индекс0 + "].Аналитика",,Отказ);
			КонецЕсли;
		КонецЕсли;
	КонецЦикла;
КонецПроцедуры


                             

