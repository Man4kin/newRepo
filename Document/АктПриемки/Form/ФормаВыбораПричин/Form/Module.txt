&НаКлиенте
Процедура ОК(Команда)
	Если ЗаполнитьПричиныВХранилище() Тогда
		Закрыть(КодВозвратаДиалога.ОК);
	Иначе
		Предупреждение("Количество расхождения в документе не совпадает с суммой количества причин ("+Формат(Параметры.КоличествоРасхождения,"ЧГ=0")+")");
	КонецЕсли;
КонецПроцедуры

&НаСервере
Функция ЗаполнитьПричиныВХранилище()
	СтрокиТЧ = СписокПричин.НайтиСтроки(Новый Структура("Пометка",Истина));
	тзВременная = СписокПричин.Выгрузить(СтрокиТч,);
	Если тзВременная.Количество()>1 Тогда
		Если тзВременная.Итог("Количество") <> Параметры.КоличествоРасхождения Тогда
			Возврат Ложь;
		КонецЕсли;
	ИначеЕсли тзВременная.Количество()=1 тогда
		тзВременная[0].Количество = Параметры.КоличествоРасхождения;
	КонецЕсли;
	ПоместитьВоВременноеХранилище(тзВременная,Параметры.Адрес);	
	Возврат Истина;
КонецФункции

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	тзПричин = ПолучитьИзВременногоХранилища(Параметры.Адрес);
	Для Каждого ЭлементПеречисление из Перечисления.РезультатПриемки Цикл
		НоваяСтрока = СписокПричин.Добавить();	
		НоваяСтрока.Причина = ЭлементПеречисление;
		МассивСтрок = тзПричин.НайтиСтроки(Новый Структура("Причина",ЭлементПеречисление));
		Если МассивСтрок.Количество()>0 Тогда
			НоваяСтрока.Пометка = Истина;
			НоваяСтрока.Количество = МассивСтрок[0].Количество;
		КонецЕсли;
	КонецЦикла;
КонецПроцедуры

&НаКлиенте
Процедура СписокПричинПередНачаломДобавления(Элемент, Отказ, Копирование, Родитель, Группа)
	Отказ = Истина;
КонецПроцедуры

&НаКлиенте
Процедура СписокПричинПередУдалением(Элемент, Отказ)
	Отказ = Истина;
КонецПроцедуры
