
&НаКлиенте
Процедура ДобавитьСотрудниковИзЗУП(Команда)
	
	АдресХранилища = ОткрытьФормуМодально("Документ.Izh_ПриказОРаспределенииНадбавок.Форма.ФормаВыбораМагазина", Новый Структура("Объект", Объект));	
	Если ЗначениеЗаполнено(АдресХранилища) Тогда
		ДобавитьСотрудниковИзХранилищаНаСервере(АдресХранилища);
	КонецЕсли;
	
КонецПроцедуры

&НаСервере
Процедура ДобавитьСотрудниковИзХранилищаНаСервере(АдресХранилища);	                        
	
	ТаблицаСотрудников = ПолучитьИзВременногоХранилища(АдресХранилища);	
		
	Если ТипЗнч(ТаблицаСотрудников) = Тип("ТаблицаЗначений") Тогда		
		Для Каждого СтрокаТаб Из ТаблицаСотрудников Цикл
			
			Отбор = Новый Структура;
			Отбор.Вставить("КодСотрудника", СтрокаТаб.КодСотрудника);
			
			Если Объект.Распределение.НайтиСтроки(Отбор).Количество() = 0 Тогда
				НоваяСтрока = Объект.Распределение.Добавить();
				ЗаполнитьЗначенияСвойств(НоваяСтрока, СтрокаТаб);														
			КонецЕсли;
			
		КонецЦикла;		
	КонецЕсли;	
	
КонецПроцедуры

&НаКлиенте
Процедура РаспределениеПроцентРаспределенияПриИзменении(Элемент)
	
	Попытка
		ТекПроцент = Элементы.Распределение.ТекущиеДанные.ПроцентРаспределения;
		Если ТекПроцент > 100 Тогда
			Элементы.Распределение.ТекущиеДанные.ПроцентРаспределения = 100;
		КонецЕсли;		
		Если ТекПроцент < -100 Тогда
			Элементы.Распределение.ТекущиеДанные.ПроцентРаспределения = -100;
		КонецЕсли;
		Если Элементы.Распределение.ТекущиеДанные.ВидРаспределения <> ПредопределенноеЗначение("Перечисление.Izh_ВидыПерераспределенияНадбавок.Лишение") Тогда
			Элементы.Распределение.ТекущиеДанные.ПроцентРаспределения = 0;
		КонецЕсли;
	Исключение
		СообщениеОшибки = ОписаниеОшибки();
	КонецПопытки;
	
КонецПроцедуры

&НаКлиенте
Процедура ПриОткрытии(Отказ)
	
	НачИнд = Месяц(ТекущаяДата())-1;
	КонИнд = Месяц(ТекущаяДата())+1;
	Для ИндМес = НачИнд По КонИнд Цикл		
		НачалоТекМесяца = Дата(Формат(Год(ТекущаяДата()), "ЧЦ=4; ЧГ=") + Формат(ИндМес, "ЧЦ=2; ЧВН=") + "01");
		ПредстТекМесяца = Формат(НачалоТекМесяца, "ДФ='ММММ гггг'");
		
		Элементы.ПериодМесяц.СписокВыбора.Добавить(НачалоТекМесяца, ПредстТекМесяца);		
	КонецЦикла;	
	ПериодМесяц = Формат(Объект.ПериодПерераспределения, "ДФ='ММММ гггг'");	
	
КонецПроцедуры

&НаКлиенте
Процедура ПериодМесяцОбработкаВыбора(Элемент, ВыбранноеЗначение, СтандартнаяОбработка)
	
	СтандартнаяОбработка = Ложь;	
	Объект.ПериодПерераспределения = ВыбранноеЗначение;
	ПериодМесяц = Формат(Объект.ПериодПерераспределения, "ДФ='ММММ гггг'");	
	
КонецПроцедуры
