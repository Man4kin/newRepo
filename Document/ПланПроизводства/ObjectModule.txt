
Процедура ПриКопировании(ОбъектКопирования)
	Автор = ПараметрыСеанса.ТекущийПользователь;
КонецПроцедуры

Процедура ПередЗаписью(Отказ, РежимЗаписи, РежимПроведения)
	//Если НЕ ЭтотОбъект.ЭтоНовый() Тогда
	//	Отказ = РаботаСФормамиСервер.ЗапрещеноРедактировать(ЭтотОбъект.Ссылка);
	//	Если Отказ Тогда
	//		Возврат;
	//	КонецЕсли;
	//КонецЕсли;	
КонецПроцедуры

Процедура ОбработкаЗаполнения(ДанныеЗаполнения, СтандартнаяОбработка)
	ИнициализироватьДокумент();
КонецПроцедуры

Процедура ИнициализироватьДокумент() Экспорт
	Автор = ПараметрыСеанса.ТекущийПользователь;
КонецПроцедуры


Процедура ОбработкаПроведения(Отказ, РежимПроведения)
	Запрос = Новый Запрос(
	"ВЫБРАТЬ
	|	ВложенныйЗапрос.Номенклатура,
	|	ВложенныйЗапрос.СтруктурнаяЕдиница,
	|	СУММА(ВложенныйЗапрос.Понедельник) КАК Понедельник,
	|	СУММА(ВложенныйЗапрос.Вторник) КАК Вторник,
	|	СУММА(ВложенныйЗапрос.Среда) КАК Среда,
	|	СУММА(ВложенныйЗапрос.Четверг) КАК Четверг,
	|	СУММА(ВложенныйЗапрос.Пятница) КАК Пятница,
	|	СУММА(ВложенныйЗапрос.Суббота) КАК Суббота,
	|	СУММА(ВложенныйЗапрос.Воскресенье) КАК Воскресенье
	|ИЗ
	|	(ВЫБРАТЬ
	|		ЗаказВПроизводствоСрезПоследних.Продукция КАК Номенклатура,
	|		ЗаказВПроизводствоСрезПоследних.Магазин КАК СтруктурнаяЕдиница,
	|		0 КАК Понедельник,
	|		0 КАК Вторник,
	|		0 КАК Среда,
	|		0 КАК Четверг,
	|		0 КАК Пятница,
	|		0 КАК Суббота,
	|		0 КАК Воскресенье
	|	ИЗ
	|		РегистрСведений.ЗаказВПроизводство.СрезПоследних(&Дата, Склад = &Склад) КАК ЗаказВПроизводствоСрезПоследних
	|	ГДЕ
	|		ЗаказВПроизводствоСрезПоследних.Понедельник + ЗаказВПроизводствоСрезПоследних.Вторник + ЗаказВПроизводствоСрезПоследних.Среда + ЗаказВПроизводствоСрезПоследних.Четверг + ЗаказВПроизводствоСрезПоследних.Пятница + ЗаказВПроизводствоСрезПоследних.Суббота + ЗаказВПроизводствоСрезПоследних.Воскресенье <> 0
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ
	|		ПланПроизводстваРаспределение.Номенклатура,
	|		ПланПроизводстваРаспределение.СтруктурнаяЕдиница,
	|		ПланПроизводстваРаспределение.Понедельник * ПланПроизводстваРаспределение.Коэффициент,
	|		ПланПроизводстваРаспределение.Вторник * ПланПроизводстваРаспределение.Коэффициент,
	|		ПланПроизводстваРаспределение.Среда * ПланПроизводстваРаспределение.Коэффициент,
	|		ПланПроизводстваРаспределение.Четверг * ПланПроизводстваРаспределение.Коэффициент,
	|		ПланПроизводстваРаспределение.Пятница * ПланПроизводстваРаспределение.Коэффициент,
	|		ПланПроизводстваРаспределение.Суббота * ПланПроизводстваРаспределение.Коэффициент,
	|		ПланПроизводстваРаспределение.Воскресенье * ПланПроизводстваРаспределение.Коэффициент
	|	ИЗ
	|		Документ.ПланПроизводства.Распределение КАК ПланПроизводстваРаспределение
	|	ГДЕ
	|		ПланПроизводстваРаспределение.Ссылка = &Ссылка) КАК ВложенныйЗапрос
	|
	|СГРУППИРОВАТЬ ПО
	|	ВложенныйЗапрос.Номенклатура,
	|	ВложенныйЗапрос.СтруктурнаяЕдиница");
	Запрос.УстановитьПараметр("Ссылка",Ссылка);
	Запрос.УстановитьПараметр("Дата",МоментВремени());
	Запрос.УстановитьПараметр("Склад",Склад);
	ТЗПланПроизводства = Запрос.Выполнить().Выгрузить();
	Для Каждого ТекСтрокаСостав Из ТЗПланПроизводства Цикл
		Движение = Движения.ЗаказВПроизводство.Добавить();
		Движение.Период = Дата;
		Движение.Продукция = ТекСтрокаСостав.Номенклатура;
		Движение.Склад = Склад;
		Движение.Магазин = ТекСтрокаСостав.СтруктурнаяЕдиница;
		Движение.Понедельник = ТекСтрокаСостав.Понедельник;
		Движение.Вторник = ТекСтрокаСостав.Вторник;
		Движение.Среда = ТекСтрокаСостав.Среда;
		Движение.Четверг = ТекСтрокаСостав.Четверг;
		Движение.Пятница = ТекСтрокаСостав.Пятница;
		Движение.Суббота = ТекСтрокаСостав.Суббота;
		Движение.Воскресенье = ТекСтрокаСостав.Воскресенье;
	КонецЦикла;
	
КонецПроцедуры

