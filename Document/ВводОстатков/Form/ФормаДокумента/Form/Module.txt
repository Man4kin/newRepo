&НаКлиенте
Перем прчКупленныеТовары,прчКомиссионныеТовары,прчХранимыеТовары,прчДенежныеСредства,прчТоварыПереданныеНаКомиссию,прчРеализованныеТовары;

&НаКлиенте
Процедура ЕдиницаИзмеренияПриИзменении(Элемент)
	ОбработкаТабличныхЧастейКлиент.ПриИзмененииЕдиницыИзмеренияВТабличнойЧасти(ЭтаФорма);
КонецПроцедуры

&НаСервере
Процедура ПриЗагрузкеДанныхИзНастроекНаСервере(Настройки)
	Если Элементы.Найти("ПодборНоменклатуры")<>Неопределено тогда
		Значение = Настройки.Получить("ОтображениеТаблицыПодбор");
		Если Значение<>Неопределено тогда
			Элементы.ПодборНоменклатуры.Отображение = Значение;
		конецесли;
	конецесли;
	Если ЗначениеЗаполнено(Объект.Ссылка) или ЗначениеЗаполнено(Параметры.Основание) или ЗначениеЗаполнено(Параметры.ЗначениеКопирования) Тогда
		Настройки.Очистить();
	КонецЕсли;
КонецПроцедуры

&НаСервере
Процедура ПриСохраненииДанныхВНастройкахНаСервере(Настройки)
	Если Элементы.Найти("ПодборНоменклатуры")<>Неопределено тогда
	Настройки.вставить("ОтображениеТаблицыПодбор",элементы.подборНоменклатуры.Отображение);
	конецесли;
КонецПроцедуры

//Процедуры и функции для оргаизации подбора
&НаКлиенте
Процедура ПодборНоменклатурыВыбор(Элемент, ВыбраннаяСтрока, Поле, СтандартнаяОбработка)
	ИмяСостава = ОпределитьИмяСтраницы();
	Для Каждого Строка Из Элемент.ВыделенныеСтроки Цикл
		Количество = ОбработкаТабличныхЧастейКлиент.ЗапросКоличества(ЗапрашиватьКоличество);
		ОбработкаТабличныхЧастейКлиент.ЗаполнитьИзПодбора(ЭтаФорма,Объект,Элемент.ДанныеСтроки(Строка),Элементы[ИмяСостава],СтандартнаяОбработка,Количество,Ложь,ИмяСостава);
	КонецЦикла;	
КонецПроцедуры

&НаСервере
Функция ОпределитьИмяСтраницы()
	
	Если Объект.ТипОстатков = Перечисления.ТипыОстатков.КомиссионныеТовары Тогда
		Возврат "КомиссионныеТовары";
	ИначеЕсли Объект.ТипОстатков = Перечисления.ТипыОстатков.КупленныеТовары Тогда	
		Возврат "КупленныеТовары";
	ИначеЕсли Объект.ТипОстатков = Перечисления.ТипыОстатков.РеализованныеТовары Тогда	
		Возврат "РеализованныеТовары";
	ИначеЕсли Объект.ТипОстатков = Перечисления.ТипыОстатков.ТоварыПереданныеНаКомиссию Тогда	
		Возврат "ТоварыПереданныеНаКомиссию";
	ИначеЕсли Объект.ТипОстатков = Перечисления.ТипыОстатков.ХранимыеТовары Тогда	
		Возврат "ХранимыеТовары";
	КонецЕсли;	
	
	
КонецФункции	

&НаКлиенте
Процедура ПодборОткрыть(Команда)
	Элементы.ГруппаПодбор.Видимость = НЕ Элементы.ГруппаПодбор.Видимость;
КонецПроцедуры


&НаКлиенте
Процедура ТипОстатковПриИзменении(Элемент)
	
	ВидимостьСтраниц();
	ОчиститьТабЧасти();
	
КонецПроцедуры

&НаКлиенте
Процедура ОчиститьТабЧасти()
	
	Если Объект.ТипОстатков = прчКупленныеТовары Тогда
		Объект.КомиссионныеТовары.Очистить();
		Объект.ХранимыеТовары.Очистить();
		Объект.ДенежныеСредства.Очистить();
		Объект.РеализованныеТовары.Очистить();
		Объект.ТоварыПереданныеНаКомиссию.Очистить();
	ИначеЕсли Объект.ТипОстатков = прчКомиссионныеТовары Тогда
		Объект.КупленныеТовары.Очистить();
		Объект.ХранимыеТовары.Очистить();
		Объект.ДенежныеСредства.Очистить();
		Объект.РеализованныеТовары.Очистить();
		Объект.ТоварыПереданныеНаКомиссию.Очистить();
 	ИначеЕсли Объект.ТипОстатков = прчХранимыеТовары Тогда
		Объект.КупленныеТовары.Очистить();
		Объект.КомиссионныеТовары.Очистить();
		Объект.ДенежныеСредства.Очистить();
		Объект.РеализованныеТовары.Очистить();
		Объект.ТоварыПереданныеНаКомиссию.Очистить();
   ИначеЕсли Объект.ТипОстатков = прчДенежныеСредства Тогда
		Объект.КупленныеТовары.Очистить();
		Объект.КомиссионныеТовары.Очистить();
		Объект.ХранимыеТовары.Очистить();
		Объект.РеализованныеТовары.Очистить();
		Объект.ТоварыПереданныеНаКомиссию.Очистить();
   ИначеЕсли Объект.ТипОстатков = прчТоварыПереданныеНаКомиссию Тогда
		Объект.КупленныеТовары.Очистить();
		Объект.КомиссионныеТовары.Очистить();
		Объект.ХранимыеТовары.Очистить();
		Объект.РеализованныеТовары.Очистить();
		Объект.ДенежныеСредства.Очистить();		
	ИначеЕсли Объект.ТипОстатков = прчРеализованныеТовары Тогда
		Объект.КупленныеТовары.Очистить();
		Объект.КомиссионныеТовары.Очистить();
		Объект.ХранимыеТовары.Очистить();
		Объект.ТоварыПереданныеНаКомиссию.Очистить();
		Объект.ДенежныеСредства.Очистить();	
	КонецЕсли;
	
КонецПроцедуры	

&НаКлиенте
Процедура ВидимостьСтраниц()
	Элементы.ГруппаКупленныеТовары.Видимость=Объект.ТипОстатков = прчКупленныеТовары;
	Элементы.ГруппаДенежныеСредства.Видимость=Объект.ТипОстатков = прчДенежныеСредства;
	Элементы.ГруппаКомиссионныеТовары.Видимость=Объект.ТипОстатков = прчКомиссионныеТовары;
	Элементы.ГруппаХранимыеТовары.Видимость=Объект.ТипОстатков = прчХранимыеТовары;
	Элементы.ГруппаТоварыПереданныеНаКомиссию.Видимость=Объект.ТипОстатков = прчТоварыПереданныеНаКомиссию;
	Элементы.ГруппаРеализованныеТовары.Видимость=Объект.ТипОстатков = прчРеализованныеТовары;
	Элементы.Страницы.ОтображениеСтраниц=ОтображениеСтраницФормы.Нет;	
	
КонецПроцедуры	

&НаКлиенте
Процедура ПриОткрытии(Отказ)
	
	прчКупленныеТовары = ПредопределенноеЗначение("Перечисление.ТипыОстатков.КупленныеТовары"); 
	прчКомиссионныеТовары = ПредопределенноеЗначение("Перечисление.ТипыОстатков.КомиссионныеТовары");
	прчХранимыеТовары = ПредопределенноеЗначение("Перечисление.ТипыОстатков.ХранимыеТовары");
	прчДенежныеСредства = ПредопределенноеЗначение("Перечисление.ТипыОстатков.ДенежныеСредства");	
	прчТоварыПереданныеНаКомиссию = ПредопределенноеЗначение("Перечисление.ТипыОстатков.ТоварыПереданныеНаКомиссию");	
	прчРеализованныеТовары = ПредопределенноеЗначение("Перечисление.ТипыОстатков.РеализованныеТовары");	
	
	ВидимостьСтраниц();
	загрузитьНастройкиПодбора();
КонецПроцедуры

&НаКлиенте
Процедура КупленныеТоварыСтавкаНДСПриИзменении(Элемент)
	 ОбработкаТабличныхЧастейКлиент.РасчитатьСуммуВСтрокеТабличнойЧасти(Элементы.КупленныеТовары.ТекущиеДанные);
КонецПроцедуры

&НаКлиенте
Процедура КупленныеТоварыСуммаПриИзменении(Элемент)
	ТекСтрока = Элементы.КупленныеТовары.ТекущиеДанные;
	Если ТекСтрока.СуммаУпр = 0 Тогда
		ТекСтрока.СуммаУпр = ТекСтрока.Сумма;
	КонецЕсли;	
	ОбработкаТабличныхЧастейКлиент.ПриИзмененииСуммыВТабличнойЧасти(ТекСтрока);
КонецПроцедуры

&НаКлиенте
Процедура ТоварыПереданныеНаКомиссиюСуммаПриИзменении(Элемент)
	ТекСтрока = Элементы.ТоварыПереданныеНаКомиссию.ТекущиеДанные;
	Если ТекСтрока.СуммаУпр = 0 Тогда
		ТекСтрока.СуммаУпр = ТекСтрока.Сумма;
	КонецЕсли;
	ОбработкаТабличныхЧастейКлиент.ПриИзмененииСуммыВТабличнойЧасти(ТекСтрока);
КонецПроцедуры

&НаКлиенте
Процедура ТоварыПереданныеНаКомиссиюСтавкаНДСПриИзменении(Элемент)
	 ОбработкаТабличныхЧастейКлиент.РасчитатьСуммуВСтрокеТабличнойЧасти(Элементы.ТоварыПереданныеНаКомиссию.ТекущиеДанные);
КонецПроцедуры

&НаКлиенте
Процедура КомиссионныеТоварыСуммаПриИзменении(Элемент)
	ТекСтрока = Элементы.КомиссионныеТовары.ТекущиеДанные;
	Если ТекСтрока.СуммаУпр = 0 Тогда
		ТекСтрока.СуммаУпр = ТекСтрока.Сумма;
	КонецЕсли;	

КонецПроцедуры

&НаКлиенте
Процедура ХранимыеТоварыСуммаПриИзменении(Элемент)
	ТекСтрока = Элементы.ХранимыеТовары.ТекущиеДанные;
	Если ТекСтрока.СуммаУпр = 0 Тогда
		ТекСтрока.СуммаУпр = ТекСтрока.Сумма;
	КонецЕсли;
КонецПроцедуры

&НаКлиенте
Процедура КупленныеТоварыСуммаУпрПриИзменении(Элемент)
	ТекСтрока = Элементы.КупленныеТовары.ТекущиеДанные;
	ОбработкаТабличныхЧастейКлиент.ПриИзмененииСуммыВТабличнойЧасти(ТекСтрока);
КонецПроцедуры

&НаКлиенте
Процедура ТоварыПереданныеНаКомиссиюСуммаУпрПриИзменении(Элемент)
	ТекСтрока = Элементы.ТоварыПереданныеНаКомиссию.ТекущиеДанные;
	ОбработкаТабличныхЧастейКлиент.ПриИзмененииСуммыВТабличнойЧасти(ТекСтрока);
КонецПроцедуры


&НаКлиенте
Процедура РеализованныеТоварыСуммаПродажиПриИзменении(Элемент)
	ТекСтрока = Элементы.РеализованныеТовары.ТекущиеДанные;
	ТекСтрока.СуммаНДСПродажи = ОбработкаТабличныхЧастейКлиент.РассчитатьСуммуНДС(ТекСтрока.СуммаПродажи,Истина,ОбщегоНазначенияСервер.ПолучитьСтавкуНДС(ТекСтрока.СтавкаНДС));
КонецПроцедуры


&НаКлиенте
Процедура РеализованныеТоварыСтавкаНДСПриИзменении(Элемент)
	ТекСтрока = Элементы.РеализованныеТовары.ТекущиеДанные;
	ТекСтрока.СуммаНДСПродажи = ОбработкаТабличныхЧастейКлиент.РассчитатьСуммуНДС(ТекСтрока.СуммаПродажи,Истина,ОбщегоНазначенияСервер.ПолучитьСтавкуНДС(ТекСтрока.СтавкаНДС));
КонецПроцедуры


&НаКлиенте
Процедура ТоварыПереданныеНаКомиссиюСуммаПродажиПриИзменении(Элемент)
	ТекСтрока = Элементы.ТоварыПереданныеНаКомиссию.ТекущиеДанные;
	ТекСтрока.СуммаНДСПродажи = ОбработкаТабличныхЧастейКлиент.РассчитатьСуммуНДС(ТекСтрока.СуммаПродажи,Истина,ОбщегоНазначенияСервер.ПолучитьСтавкуНДС(ТекСтрока.СтавкаНДС));
КонецПроцедуры


&НаКлиенте
Процедура КомиссионныеТоварыКомитентНачалоВыбора(Элемент, ДанныеВыбора, СтандартнаяОбработка)
	Элемент.ВыбиратьТип = Элементы.КомиссионныеТовары.ТекущиеДанные.Комитент = Неопределено;
КонецПроцедуры


&НаКлиенте
Процедура КомиссионныеТоварыКомитентОчистка(Элемент, СтандартнаяОбработка)
	Элементы.КомиссионныеТовары.ТекущиеДанные.Комитент = Неопределено;
КонецПроцедуры

&НаКлиенте
Процедура ТоварыПереданныеНаКомиссиюКонтрагентНачалоВыбора(Элемент, ДанныеВыбора, СтандартнаяОбработка)
	Элемент.ВыбиратьТип = Элементы.ТоварыПереданныеНаКомиссию.ТекущиеДанные.Контрагент = Неопределено;
КонецПроцедуры

&НаКлиенте
Процедура ТоварыПереданныеНаКомиссиюКонтрагентОчистка(Элемент, СтандартнаяОбработка)
	Элементы.ТоварыПереданныеНаКомиссию.ТекущиеДанные.Контрагент = Неопределено;
КонецПроцедуры

&НаКлиенте
Процедура РеализованныеТоварыКомитентНачалоВыбора(Элемент, ДанныеВыбора, СтандартнаяОбработка)
	Элемент.ВыбиратьТип = Элементы.РеализованныеТовары.ТекущиеДанные.Комитент = Неопределено;
КонецПроцедуры

&НаКлиенте
Процедура РеализованныеТоварыКомитентОчистка(Элемент, СтандартнаяОбработка)
	Элементы.РеализованныеТовары.ТекущиеДанные.Комитент = Неопределено;
КонецПроцедуры


&НаКлиенте
Процедура ПоказатьГруппыВПодборе(Команда)
	элементы.кнГруппы.пометка = не элементы.кнГруппы.пометка;
	флаг = Элементы.кнГруппы.пометка;
	ВЫполнить("ОбработкаТабличныхЧастейКлиент.ОтображениеГрупп(ПодборНоменклатуры,флаг)");
КонецПроцедуры

&НаСервере
Процедура Сохранитьпараметрыподбора()
	ПОдборНоменклатурыСервер.СохранитьПараметрыПодбора(Объект.Ссылка.Метаданные().имя,ЭтаФорма.ИмяФормы,ЭтаФорма.Элементы);
конецпроцедуры

&НаСервере
Функция получитьНастройкуПодбора()
	возврат подборНоменклатурыСервер.ПолучитьНастройкуподбора(Объект.Ссылка.Метаданные().Имя,ЭтаФорма.ИмяФормы);	
конецфункции

&НаКлиенте
процедура ЗагрузитьНастройкиПодбора()
		Настройки = ПолучитьНастройкуПодбора();
		ОбработкаТабличныхЧастейКлиент.загрузитьнастройкиподбора(ЭтаФорма,Настройки);
конецпроцедуры

&НаКлиенте
Процедура ПодборЗакрыть(Команда)
	Элементы.ГруппаПодбор.Видимость  = Ложь;
КонецПроцедуры


&НаКлиенте
Процедура Дерево(Команда)
	обработкатабличныхчастейклиент.ОтображениеДинамическогоСпискаДерево(ЭтаФорма);	
КонецПроцедуры


&НаКлиенте
Процедура Иерархия(Команда)
	обработкатабличныхчастейклиент.отображениединамическогоспискаиерархия(этаформа);	
КонецПроцедуры


&НаКлиенте
Процедура Список(Команда)
	обработкатабличныхчастейклиент.ОтображениеДинамическогоСпискаСписок(этаформа);	
КонецПроцедуры


&НаКлиенте
Процедура СоставПередНачаломДобавления(Элемент, Отказ, Копирование, Родитель, Группа)
	Отказ = Истина;
	ПодборОткрыть(Неопределено);
КонецПроцедуры


&НаКлиенте
Процедура ПриЗакрытии()
	СохранитьПараметрыПодбора();
КонецПроцедуры

&НаКлиенте
Процедура НастройкаПодбора(Команда)
	ПараметрыПодбора = ОткрытьФормуМодально("ОбщаяФорма.НастройкаПодбора", Новый Структура("ЗапрашиватьКоличество", ЗапрашиватьКоличество));
	ЗапрашиватьКоличество = ПараметрыПодбора.ЗапрашиватьКоличество;
КонецПроцедуры

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	ДополнительныеОтчетыИОбработки.ПриСозданииНаСервере(ЭтаФорма);
КонецПроцедуры
