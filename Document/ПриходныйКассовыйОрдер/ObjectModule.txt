
Процедура ОбработкаПроведения(Отказ, Режим)
	Движение = Движения.ДенежныеСредства.Добавить();
	Движение.ВидДвижения = ВидДвиженияНакопления.Приход;
	Движение.Период = Дата;
	Движение.ДенежнаяЯчейка = Касса;
	Движение.Фирма = Фирма;
	Движение.Сумма = Сумма;
	Движение.Валюта = Валюта;
	
	Движение.КлассификаторДДС = КлассификаторДДС;
	Если КлассификаторДДС = ПланыВидовХарактеристик.КлассификаторДДС.РасчетыСПодотчетниками или КлассификаторДДС = ПланыВидовХарактеристик.КлассификаторДДС.ОперацииСККМ Тогда
		Движение = Движения.ДенежныеСредства.Добавить();
		Движение.ВидДвижения = ВидДвиженияНакопления.Расход;
		Движение.Период = Дата;
		Движение.ДенежнаяЯчейка = Аналитика;
		Движение.Фирма = Фирма;
		Движение.Сумма = Сумма;
		Движение.КлассификаторДДС = КлассификаторДДС;
		Движение.Валюта = Валюта;
	КонецЕсли;	
КонецПроцедуры

Процедура ОбработкаЗаполнения(ДанныеЗаполнения, СтандартнаяОбработка)
	Если ТипЗнч(ДанныеЗаполнения) = Тип("ДокументСсылка.РасходнаяНакладная") Тогда
		ПринятоОт = ДанныеЗаполнения.Контрагент.Наименование;
		Основание = ДанныеЗаполнения.Основание;
		ДокументОснование = ДанныеЗаполнения;
		Сумма = ДанныеЗаполнения.Ссылка.Состав.Итог("Сумма");
		СуммаНДС = ДанныеЗаполнения.Ссылка.Состав.Итог("СуммаНДС");
		СтруктурнаяЕдиница = ДанныеЗаполнения.СтруктурнаяЕдиница;
		КлассификаторДДС = ПланыВидовХарактеристик.КлассификаторДДС.РасчетыСПокупателями;
		Аналитика = ДанныеЗаполнения.Контрагент;
	ИначеЕсли ТипЗнч(ДанныеЗаполнения) = Тип("ДокументСсылка.Счет") Тогда
		ПринятоОт = ДанныеЗаполнения.Контрагент.Наименование;
		Основание = ДанныеЗаполнения;
		ДокументОснование = ДанныеЗаполнения;
		Сумма = ДанныеЗаполнения.Ссылка.Состав.Итог("Сумма");
		СуммаНДС = ДанныеЗаполнения.Ссылка.Состав.Итог("СуммаНДС");
		СтруктурнаяЕдиница = ДанныеЗаполнения.СтруктурнаяЕдиница;
		КлассификаторДДС = ПланыВидовХарактеристик.КлассификаторДДС.РасчетыСПокупателями;
		Аналитика = ДанныеЗаполнения.Контрагент;
	ИначеЕсли ТипЗнч(ДанныеЗаполнения) = Тип("Структура") Тогда
		ПринятоОт = ДанныеЗаполнения.Аналитика.Наименование;
		Сумма = ДанныеЗаполнения.Всего;
		СтруктурнаяЕдиница = ДанныеЗаполнения.Основание.СтруктурнаяЕдиница;
		Аналитика = ДанныеЗаполнения.Аналитика;
		ДокументОснование = ДанныеЗаполнения.Основание;
		Фирма = ДанныеЗаполнения.Основание.Фирма;
	КонецЕсли;
	ИнициализироватьДокумент();
КонецПроцедуры

Процедура ИнициализироватьДокумент()
	Автор = ПараметрыСеанса.ТекущийПользователь;
	Если Не ЗначениеЗаполнено(Валюта) Тогда
		Если ТипЗнч(Аналитика) = ТипЗнч("СправочникСсылка.Контрагенты") И ЗначениеЗаполнено(Аналитика.Валюта) Тогда
			Валюта = Аналитика.Валюта;
		Иначе
			Валюта = СтруктурныеЕдиницы.ПолучитьВалютуТекущейСЕ();
		КонецЕсли;
		
		СтруктураКурса = РаботаСКурсамиВалют.ЗаполнитьДанныеКурсаДляВалюты(Валюта);
		Курс = СтруктураКурса.Курс;
		Кратность = СтруктураКурса.Кратность;
	КонецЕсли;
	
	Если НЕ ЗначениеЗаполнено(КлассификаторДДС) Тогда
		КлассификаторДДС = ПланыВидовХарактеристик.КлассификаторДДС.ОперацииСККМ;
	КонецЕсли;
	
	Если НЕ ЗначениеЗаполнено(СтавкаНДС) Тогда
		СтавкаНДС = ОбщегоНазначенияСервер.ПолучитьОсновнуюСтавкуНДС();
	КонецЕсли;
	Если НЕ ЗначениеЗаполнено(СтруктурнаяЕдиница) И НЕ ПараметрыСеанса.ТекущаяСтруктурнаяЕдиница.ЭтоГруппа Тогда
		СтруктурнаяЕдиница = ПараметрыСеанса.ТекущаяСтруктурнаяЕдиница;
	КонецЕсли;
	
КонецПроцедуры

Процедура ПриКопировании(ОбъектКопирования)
	Автор = ПараметрыСеанса.ТекущийПользователь;
КонецПроцедуры

Процедура ОбработкаПроверкиЗаполнения(Отказ, ПроверяемыеРеквизиты)
	Если КлассификаторПокупательПоставщик(ЭтотОбъект.КлассификаторДДС) Тогда
		ПроверяемыеРеквизиты.Добавить("ТипДоговора");
	КонецЕсли;
	Если НЕ ЭтотОбъект.КлассификаторДДС = ПредопределенноеЗначение("ПланВидовХарактеристик.КлассификаторДДС.ПрочиеВыплатыИПоступления") ИЛИ ЗначениеЗаполнено(ЭтотОбъект.СтатьяДвиженияДенежныхСредств.ТипАналитики) Тогда
		ПроверяемыеРеквизиты.Добавить("Аналитика");
	КонецЕсли;	
КонецПроцедуры
	
Функция КлассификаторПокупательПоставщик(КлассификаторДДС)
	Да = КлассификаторДДС = ПланыВидовХарактеристик.КлассификаторДДС.РасчетыСПокупателями
	ИЛИ КлассификаторДДС = ПланыВидовХарактеристик.КлассификаторДДС.РасчетыСПоставщиками;
	Возврат Да;
КонецФункции


