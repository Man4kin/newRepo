
Процедура ОбработкаЗаполнения(ДанныеЗаполнения, СтандартнаяОбработка)
	ИнициализироватьДокумент();
КонецПроцедуры

Процедура ИнициализироватьДокумент() Экспорт
	Автор = ПараметрыСеанса.ТекущийПользователь;
	Если НЕ ЗначениеЗаполнено(Контрагент) Тогда
		Контрагент = Справочники.Контрагенты.ПустаяСсылка();
	КонецЕсли;	
КонецПроцедуры

Процедура ПриКопировании(ОбъектКопирования)
	Автор = ПараметрыСеанса.ТекущийПользователь;
КонецПроцедуры

Процедура ОбработкаПроведения(Отказ, РежимПроведения)
	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	ЗаказВнешнийСостав.Ссылка.Контрагент КАК Контрагент,
		|	ЗаказВнешнийСостав.Номенклатура КАК Номенклатура,
		|	ЗаказВнешнийСостав.ДатаПоставки,
		|	ЗаказВнешнийСостав.Количество * ЗаказВнешнийСостав.Коэффициент КАК Количество,
		|	ЗаказВнешнийСостав.Ссылка.Склад КАК Склад
		|ИЗ
		|	Документ.ЗаказВнешний.Состав КАК ЗаказВнешнийСостав
		|ГДЕ
		|	ЗаказВнешнийСостав.Ссылка = &Ссылка
		|	И ЗаказВнешнийСостав.Номенклатура ССЫЛКА Справочник.Номенклатура";

	Запрос.УстановитьПараметр("Ссылка", Ссылка);

	Результат = Запрос.Выполнить();

	ВыборкаДетальныеЗаписи = Результат.Выбрать();

	Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
		Движение = Движения.ВнешнийЗаказ.Добавить();
		Движение.Регистратор = Ссылка;
		Движение.Склад = ВыборкаДетальныеЗаписи.Склад;
		Движение.Контрагент = ВыборкаДетальныеЗаписи.Контрагент;
		Движение.Номенклатура = ВыборкаДетальныеЗаписи.Номенклатура;
		Движение.ДатаПоставки = ВыборкаДетальныеЗаписи.ДатаПоставки;
		Движение.ПоДокументу = Ссылка;
		Движение.Количество = ВыборкаДетальныеЗаписи.Количество;
	КонецЦикла;
	Если НЕ EDIПровайдер.Пустая() И ТипЗнч(Контрагент) = Тип("СправочникСсылка.Контрагенты") И Контрагент.ПодтверждениеЗаказаEDI Тогда	
		Если НЕ (ДополнительныеСвойства.Свойство("БылПроведен") И ДополнительныеСвойства.БылПроведен) Тогда
			Узел = ОбменДаннымиEDIСервер.ПолучитьУзелРегистрацииEDIПоставщик(ЭтотОбъект.EDIПровайдер);
			Если Узел <> Неопределено Тогда
				ПланыОбмена.ЗарегистрироватьИзменения(Узел,ЭтотОбъект);	
			КонецЕсли;
		КонецЕсли;
	КонецЕсли;	
КонецПроцедуры

Процедура ПередЗаписью(Отказ, РежимЗаписи, РежимПроведения)
	//Если НЕ ЭтотОбъект.ЭтоНовый() Тогда
	//	Отказ = РаботаСФормамиСервер.ЗапрещеноРедактировать(ЭтотОбъект.Ссылка);
	//	Если Отказ Тогда
	//		Возврат;
	//	КонецЕсли;
	//КонецЕсли;
	СуммаИтого = Состав.Итог("Сумма");
	СуммаНДСИтого = Состав.Итог("СуммаНДС");
	СтруктурнаяЕдиница = Склад.Владелец;
	
	//{ СИТЕК БрыляковЕЮ 2015-04-30  
	Если ОбменДанными.Загрузка Тогда
		Возврат;
	КонецЕсли;
	// СИТЕК БрыляковЕЮ 2015-04-30 }
	
	//{ ++ВетровИА 26.03.2015 Наряд №000145346}
	Отказ = Izh_ОбработкаТабличныхЧастейКлиентСервер.ПроверитьНаПравилоПерепродажи(ЭтотОбъект);
	//{ --ВетровИА 26.03.2015 Наряд №000145346}
КонецПроцедуры

