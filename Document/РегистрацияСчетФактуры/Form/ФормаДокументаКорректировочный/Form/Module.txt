////////////////////////////////////////////////////////////////////////////////
// ОБРАБОТЧИКИ СОБЫТИЙ ФОРМЫ

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	Если Параметры.Ключ.Пустая() Тогда
		ПодготовитьФормуНаСервере();
	КонецЕсли;
	
	ТолькоПросмотр = РаботаСФормамиСервер.ЗапрещеноРедактировать(Объект.Ссылка,ЭтаФорма);
	
	//{БредовЮГ 2014-12-03 Наряд№000135628
	Элементы.Izh_ОбработанЦВД.Видимость = ПараметрыСеанса.ЭтоЦентр;
	Izh_ОбработанЦВД = РегистрыСведений.Izh_СостояниеДокумента.ДокументЗафиксированВСостоянии(Объект,Перечисления.Izh_СостояниеДокумента.ПроверенЦВД);
	//БредовЮГ 2014-12-03 Наряд№000135628}
	
	//Если НЕ ПараметрыСеанса.ЭтоЦентр Тогда
	//	Элементы.ОбработанЦВД.Доступность = Ложь;
	//	Элементы.ОбработанЦВД.Видимость = ПараметрыСеанса.ИспользованиеЦВД;
	//КонецЕсли;	
	ОбщегоНазначенияСервер.ЗапретМодификацииОбъектов(ЭтаФорма);
	ДополнительныеОтчетыИОбработки.ПриСозданииНаСервере(ЭтаФорма);
КонецПроцедуры

&НаСервере
Процедура ПослеЗаписиНаСервере(ТекущийОбъект, ПараметрыЗаписи)
	
	УстановитьЗаголовокФормы(ЭтаФорма);

КонецПроцедуры

////////////////////////////////////////////////////////////////////////////////
// ОБРАБОТЧИКИ СОБЫТИЙ ЭЛЕМЕНТОВ ШАПКИ ФОРМЫ
&НаКлиенте
Процедура ИсправлениеПриИзменении(Элемент)
	
	ИсправлениеПриИзмененииНаСервере();
	
	Если НЕ Объект.Исправление Тогда
		Объект.НомерИсправления	= 0;
		Объект.ДатаИсправления	= '00010101';
	КонецЕсли;
	
	УправлениеФормой(ЭтаФорма);
	
КонецПроцедуры

&НаКлиенте
Процедура УчитыватьИсправлениеИсходногоДокументаПриИзменении(Элемент)

	Если НЕ Объект.УчитыватьИсправлениеИсходногоДокумента Тогда
		Объект.НомерИсправленияИсходногоДокумента = Неопределено;
		Объект.ДатаИсправленияИсходногоДокумента = Неопределено;
	КонецЕсли;
	
	УправлениеФормой(ЭтаФорма);
	
КонецПроцедуры

&НаКлиенте
Процедура КодВидаОперацииНачалоВыбора(Элемент, ДанныеВыбора, СтандартнаяОбработка)
	
	СтандартнаяОбработка = Ложь;
	ТекущийКод = Элемент.СписокВыбора.НайтиПоЗначению(Объект.КодВидаОперации);
	ВыбранныйКод = ВыбратьИзСписка(Элемент.СписокВыбора, Элемент, ТекущийКод);
	Если ВыбранныйКод <> Неопределено Тогда
		Объект.КодВидаОперации = ВыбранныйКод.Значение;
	КонецЕсли;
	
КонецПроцедуры

////////////////////////////////////////////////////////////////////////////////
// ОБРАБОТЧИКИ КОМАНД ФОРМЫ

////////////////////////////////////////////////////////////////////////////////
// СЛУЖЕБНЫЕ ПРОЦЕДУРЫ И ФУНКЦИИ

&НаСервере
Процедура ПодготовитьФормуНаСервере()
	
	УчетНДС.ЗаполнитьСписокКодовВидовОпераций(Истина, ЭтаФорма.Элементы.КодВидаОперации.СписокВыбора);
	УправлениеФормой(ЭтаФорма);
	
КонецПроцедуры

&НаКлиентеНаСервереБезКонтекста
Процедура УправлениеФормой(Форма)
	
	Элементы	= Форма.Элементы;
	Объект		= Форма.Объект;
	
	Элементы.НомерИсправления.Доступность	= Объект.Исправление;
	Элементы.ДатаИсправления.Доступность	= Объект.Исправление;
	
	Элементы.НомерИсправленияИсходногоДокумента.Доступность	= Объект.УчитыватьИсправлениеИсходногоДокумента;
	Элементы.ДатаИсправленияИсходногоДокумента.Доступность	= Объект.УчитыватьИсправлениеИсходногоДокумента;
	
КонецПроцедуры

&НаКлиентеНаСервереБезКонтекста
Процедура УстановитьЗаголовокФормы(Форма)
	
	Объект = Форма.Объект;
	
	Если ЗначениеЗаполнено(Объект.Ссылка) Тогда
		Форма.Заголовок = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(
			НСтр("ru='Счет-фактура полученный (корректировочный) %1 от %2'"),
			Объект.Номер,
			Объект.Дата);
	Иначе
		Форма.Заголовок = НСтр("ru='Счет-фактура полученный (корректировочный) (создание)'");
	КонецЕсли;

КонецПроцедуры

&НаСервере
Процедура ИсправлениеПриИзмененииНаСервере()

	УстановитьКодВидаОперацииНаСервере();

КонецПроцедуры

&НаСервере
Процедура УстановитьКодВидаОперацииНаСервере()
	
	Объект.КодВидаОперации	= "01";
	
КонецПроцедуры

&НаКлиенте
Процедура Перезаполнить(Команда)
	ПерезаполнитьНаСервере();
КонецПроцедуры

&НаСервере
Процедура ПерезаполнитьНаСервере()
	
	ЭтотОбъект = ДанныеФормыВЗначение(Объект,Тип("ДокументОбъект.РегистрацияСчетФактуры"));
	ЭтотОбъект.Заполнить(Объект.ДокументОснование);
	ЗначениеВДанныеФормы(ЭтотОбъект,Объект);
	
КонецПроцедуры	