
Процедура ПриОтправкеДанныхПодчиненному(ЭлементДанных, ОтправкаЭлемента, СозданиеНачальногоОбраза)
	Если ТипЗнч(ЭлементДанных) = Тип("РегистрСведенийНаборЗаписей.ПользователиСтруктурныхЕдиниц") Тогда
		Если НЕ СтруктурныеЕдиницы.ПринадлежитГруппеСЕ(ЭлементДанных.Отбор.СтруктурнаяЕдиница.Значение,СтруктурнаяЕдиница) Тогда
			ОтправкаЭлемента = ОтправкаЭлементаДанных.Игнорировать;	
		КонецЕсли;	
	//ИначеЕсли ТипЗнч(ЭлементДанных) = Тип("РегистрСведенийНаборЗаписей.ПараметрыСтруктурныхЕдиниц") Тогда
	//	Если (НЕ СтруктурныеЕдиницы.ПринадлежитГруппеСЕ(ЭлементДанных.Отбор.СтруктурнаяЕдиница.Значение,СтруктурнаяЕдиница)) И ЭлементДанных.Отбор.СтруктурнаяЕдиница.Значение <> ПараметрыСеанса.ТекущаяСтруктурнаяЕдиница Тогда  //V
	//		ОтправкаЭлемента = ОтправкаЭлементаДанных.Игнорировать;	
	//	КонецЕсли;	
	ИначеЕсли ТипЗнч(ЭлементДанных) = Тип("РегистрСведенийНаборЗаписей.ЗначенияФункциональныхОпций") Тогда
		Если НЕ СтруктурныеЕдиницы.ПринадлежитГруппеСЕ(ЭлементДанных.Отбор.СтруктурнаяЕдиница.Значение,СтруктурнаяЕдиница) Тогда
			ОтправкаЭлемента = ОтправкаЭлементаДанных.Игнорировать;	
		КонецЕсли;	
	//{БредовЮГ 2015-02-12 Исправление ошибки регистрации EDIПровайдеров	
	ИначеЕсли ТипЗнч(ЭлементДанных) = Тип("РегистрСведенийНаборЗаписей.EDIПровайдерыПоставщиков") Тогда
		Контрагент = ЭлементДанных.Отбор.Контрагент.Значение;
		Если ТипЗнч(Контрагент) = Тип("СправочникСсылка.Контрагенты") Тогда
			ОтправкаЭлемента = ОтправкаЭлементаДанных.Игнорировать;	
		ИначеЕсли ТипЗнч(Контрагент) = Тип("СправочникСсылка.СтруктурныеЕдиницы") Тогда
			Если НЕ СтруктурныеЕдиницы.ПринадлежитГруппеСЕ(Контрагент,СтруктурнаяЕдиница) Тогда
				//{БредовЮГ 2015-04-24 Записи центра должны расходиться по всем базам Наряд 000148834 от 23.04.2015 13:30:23
				Если НЕ Контрагент=Справочники.СтруктурныеЕдиницы.Центр Тогда
					ОтправкаЭлемента = ОтправкаЭлементаДанных.Игнорировать;	
				КонецЕсли;
				//БредовЮГ  2015-04-24 Наряд 000148834 от 23.04.2015 13:30:23 } 
			КонецЕсли;	
		КонецЕсли;
	//БредовЮГ 2015-02-12 Исправление ошибки регистрации EDIПровадейров		}
	ИначеЕсли ТипЗнч(ЭлементДанных) = Тип("РегистрСведенийНаборЗаписей.Адресация") Тогда
		Если НЕ СтруктурныеЕдиницы.ПринадлежитГруппеСЕ(ЭлементДанных.Отбор.СтруктурнаяЕдиница.Значение,СтруктурнаяЕдиница) Тогда
			ОтправкаЭлемента = ОтправкаЭлементаДанных.Игнорировать;	
		КонецЕсли;	
	ИначеЕсли ТипЗнч(ЭлементДанных) = Тип("РегистрСведенийНаборЗаписей.СоставыГруппПользователей") Тогда
		Если ПользовательПринадлежитСЕ(ЭлементДанных.Отбор.Пользователь.Значение) = Ложь Тогда
			ОтправкаЭлемента = ОтправкаЭлементаДанных.Игнорировать;	
		КонецЕсли;	
	ИначеЕсли ТипЗнч(ЭлементДанных) = Тип("РегистрСведенийНаборЗаписей.ПользователиГруппыДоступа") Тогда
		Если ПользовательПринадлежитСЕ(ЭлементДанных.Отбор.Пользователь.Значение) = Ложь Тогда
			ОтправкаЭлемента = ОтправкаЭлементаДанных.Игнорировать;	
		КонецЕсли;	
	ИначеЕсли ТипЗнч(ЭлементДанных) = Тип("СправочникОбъект.Пользователи") Тогда
		Если ПользовательПринадлежитСЕ(ЭлементДанных.Ссылка) = Ложь Тогда
			ОтправкаЭлемента = ОтправкаЭлементаДанных.Игнорировать;	
		КонецЕсли;	
	//ИначеЕсли ТипЗнч(ЭлементДанных) = Тип("СправочникОбъект.Склады") Тогда
	//	Если ЭлементДанных.Владелец <> СтруктурнаяЕдиница Тогда
	//		ОтправкаЭлемента = ОтправкаЭлементаДанных.Игнорировать;	
	//	КонецЕсли;	
	ИначеЕсли ТипЗнч(ЭлементДанных) = Тип("СправочникОбъект.ККМ") Тогда
		Если НЕ СтруктурныеЕдиницы.ПринадлежитГруппеСЕ(ЭлементДанных.Владелец,СтруктурнаяЕдиница) Тогда
			ОтправкаЭлемента = ОтправкаЭлементаДанных.Игнорировать;	
		КонецЕсли;	
	ИначеЕсли ТипЗнч(ЭлементДанных) = Тип("СправочникОбъект.НастройкаБизнесПроцессов") Тогда
		Если НЕ СтруктурныеЕдиницы.ПринадлежитГруппеСЕ(ЭлементДанных.Владелец,СтруктурнаяЕдиница) Тогда
			ОтправкаЭлемента = ОтправкаЭлементаДанных.Игнорировать;	
		КонецЕсли;	
	ИначеЕсли ТипЗнч(ЭлементДанных) = Тип("РегистрСведенийНаборЗаписей.Перепродажа") Тогда
		Если НЕ СтруктурныеЕдиницы.ПринадлежитГруппеСЕ(ЭлементДанных.Отбор.СтруктурнаяЕдиница.Значение,СтруктурнаяЕдиница) 
			//{ СИТЕК БрыляковЕЮ 2014-10-15  В складах должны быть все правила перепродажи
			И НЕ СтруктурнаяЕдиница.ТипСтруктурнойЕдиницы = Перечисления.ТипыСтруктурныхЕдиниц.Склад 
			// СИТЕК БрыляковЕЮ 2014-10-15 }
			Тогда
			ОтправкаЭлемента = ОтправкаЭлементаДанных.Игнорировать;	
		КонецЕсли;	
	ИначеЕсли ТипЗнч(ЭлементДанных) = Тип("РегистрСведенийНаборЗаписей.СтатусыНоменклатуры") Тогда
		Если НЕ СтруктурныеЕдиницы.ПринадлежитГруппеСЕ(ЭлементДанных.Отбор.СтруктурнаяЕдиница.Значение,СтруктурнаяЕдиница) Тогда
			ОтправкаЭлемента = ОтправкаЭлементаДанных.Игнорировать;	
		КонецЕсли;	
	ИначеЕсли ТипЗнч(ЭлементДанных) = Тип("РегистрСведенийНаборЗаписей.НоменклатураКонтрагента") Тогда
		Если СозданиеНачальногоОбраза Тогда
			ОтправкаЭлемента = ОтправкаЭлементаДанных.Игнорировать;	
		КонецЕсли;	
	ИначеЕсли ТипЗнч(ЭлементДанных) = Тип("РегистрСведенийНаборЗаписей.ЦеныНоменклатуры") Тогда
		Если СозданиеНачальногоОбраза Тогда
			ОтправкаЭлемента = ОтправкаЭлементаДанных.Игнорировать;	
		КонецЕсли;	
	ИначеЕсли ТипЗнч(ЭлементДанных) = Тип("СправочникОбъект.Номенклатура") Тогда
		Если ЭлементДанных.Группа = 0 И СозданиеНачальногоОбраза Тогда
			ОтправкаЭлемента = ОтправкаЭлементаДанных.Игнорировать;	
		КонецЕсли;	
	ИначеЕсли ТипЗнч(ЭлементДанных) = Тип("СправочникОбъект.ЕдиницыИзмерения") Тогда
		//Если ТипЗнч(ЭлементДанных.Владелец) = Тип("СправочникОбъект.Номенклатура") Тогда
		//	Если ЭлементДанных.Владелец.Группа = 0 И СозданиеНачальногоОбраза Тогда
		//		ОтправкаЭлемента = ОтправкаЭлементаДанных.Игнорировать;	
		//	КонецЕсли;
		//Иначе
		//	Если НЕ ЭлементДанных.Владелец.ЭтоГруппа И СозданиеНачальногоОбраза Тогда
		//		ОтправкаЭлемента = ОтправкаЭлементаДанных.Игнорировать;	
		//	КонецЕсли;
		//КонецЕсли;	
		Если СозданиеНачальногоОбраза Тогда
			ОтправкаЭлемента = ОтправкаЭлементаДанных.Игнорировать;	
		КонецЕсли;
	ИначеЕсли ТипЗнч(ЭлементДанных) = Тип("РегистрСведенийНаборЗаписей.СостояниеОбменовДанными") Тогда
		ОтправкаЭлемента = ОтправкаЭлементаДанных.Игнорировать;	
		//popn+
	ИначеЕсли ТипЗнч(ЭлементДанных) = Тип("РегистрСведенийНаборЗаписей.ПользовательскиеНастройкиДоступаКОбработкам") Тогда
		ТекПользователь = ЭлементДанных.Отбор.Пользователь.Значение;
		Если ТипЗнч(ТекПользователь) = Тип("СправочникСсылка.Пользователи") Тогда
			Если ПользовательПринадлежитСЕ(ТекПользователь) = Ложь Тогда
				ОтправкаЭлемента = ОтправкаЭлементаДанных.Игнорировать;	
			КонецЕсли;
		КонецЕсли;
		//popn-
	КонецЕсли;	
КонецПроцедуры

Функция ПользовательПринадлежитСЕ(Пользователь)
	Запрос = Новый Запрос("ВЫБРАТЬ ПЕРВЫЕ 1
	                      |	ПользователиСтруктурныхЕдиниц.Пользователь
	                      |ИЗ
	                      |	РегистрСведений.ПользователиСтруктурныхЕдиниц КАК ПользователиСтруктурныхЕдиниц
	                      |ГДЕ
	                      |	ПользователиСтруктурныхЕдиниц.Пользователь = &Пользователь
	                      |	И (ПользователиСтруктурныхЕдиниц.СтруктурнаяЕдиница = &СтруктурнаяЕдиница
	                      |	ИЛИ ПользователиСтруктурныхЕдиниц.СтруктурнаяЕдиница.Родитель = &СтруктурнаяЕдиница)");
	Запрос.УстановитьПараметр("Пользователь",Пользователь);					  
	Запрос.УстановитьПараметр("СтруктурнаяЕдиница",СтруктурнаяЕдиница);
	Результат = Запрос.Выполнить().Пустой();
	Возврат НЕ Результат;
КонецФункции	

Функция НоменклатураПринадлежитСЕ(Номенклатура)
	Запрос = Новый Запрос("ВЫБРАТЬ ПЕРВЫЕ 1
	                      |	СтатусыНоменклатуры.Номенклатура
	                      |ИЗ
	                      |	РегистрСведений.СтатусыНоменклатуры КАК СтатусыНоменклатуры
	                      |ГДЕ
	                      |	СтатусыНоменклатуры.СтруктурнаяЕдиница В ИЕРАРХИИ (&СтруктурнаяЕдиница)
	                      |	И (СтатусыНоменклатуры.Номенклатура = &Номенклатура
	                      |			ИЛИ СтатусыНоменклатуры.Номенклатура.Родитель = &Номенклатура
	                      |			ИЛИ СтатусыНоменклатуры.Номенклатура.Родитель.Родитель = &Номенклатура
	                      |			ИЛИ СтатусыНоменклатуры.Номенклатура В ИЕРАРХИИ (&Номенклатура))");
	Запрос.УстановитьПараметр("Номенклатура",Номенклатура);					  
	Запрос.УстановитьПараметр("СтруктурнаяЕдиница",СтруктурнаяЕдиница);
	Результат = Запрос.Выполнить().Пустой();
	Возврат НЕ Результат;
КонецФункции	


Процедура ПриПолученииДанныхОтГлавного(ЭлементДанных, ПолучениеЭлемента, ОтправкаНазад)
	Если ТипЗнч(ЭлементДанных) = Тип("СправочникОбъект.Номенклатура") Тогда
		Если НЕ Справочники.Номенклатура.НайтиПоКоду(ЭлементДанных.Код).Пустая() Тогда
			ПолучениеЭлемента = ПолучениеЭлементаДанных.Игнорировать;	
		КонецЕсли;
	ИначеЕсли ТипЗнч(ЭлементДанных) = Тип("СправочникОбъект.Контрагенты") Тогда
		Если НЕ Справочники.Контрагенты.НайтиПоКоду(ЭлементДанных.Код).Пустая() Тогда
			ПолучениеЭлемента = ПолучениеЭлементаДанных.Игнорировать;	
		КонецЕсли;
	КонецЕсли;	
КонецПроцедуры


Процедура ПриОтправкеДанныхГлавному(ЭлементДанных, ОтправкаЭлемента)
	Если ТипЗнч(ЭлементДанных) = Тип("РегистрСведенийНаборЗаписей.ПараметрыСтруктурныхЕдиниц") Тогда
		ОтправкаЭлемента = ОтправкаЭлементаДанных.Игнорировать;	
	ИначеЕсли ТипЗнч(ЭлементДанных) = Тип("РегистрСведенийНаборЗаписей.ЗначенияФункциональныхОпций") Тогда
		ОтправкаЭлемента = ОтправкаЭлементаДанных.Игнорировать;	
	ИначеЕсли ТипЗнч(ЭлементДанных) = Тип("СправочникОбъект.ШаблоныЦенников") Тогда
		ОтправкаЭлемента = ОтправкаЭлементаДанных.Игнорировать;	
	ИначеЕсли ТипЗнч(ЭлементДанных) = Тип("СправочникОбъект.ШаблоныЭтикеток") Тогда
		ОтправкаЭлемента = ОтправкаЭлементаДанных.Игнорировать;	
	//{БредовЮГ 2015-02-12 Исправление ошибки регистрации EDIПровайдеров	
	ИначеЕсли ТипЗнч(ЭлементДанных) = Тип("РегистрСведенийНаборЗаписей.EDIПровайдерыПоставщиков") Тогда
		ОтправкаЭлемента = ОтправкаЭлементаДанных.Игнорировать;	
	//БредовЮГ 2015-02-12 Исправление ошибки регистрации EDIПровайдеров		}
	//popn+
	ИначеЕсли ТипЗнч(ЭлементДанных) = Тип("СправочникОбъект.ДополнительныеОтчетыИОбработки") Тогда
		ОтправкаЭлемента = ОтправкаЭлементаДанных.Игнорировать;
	//popn-
	КонецЕсли;	
КонецПроцедуры

