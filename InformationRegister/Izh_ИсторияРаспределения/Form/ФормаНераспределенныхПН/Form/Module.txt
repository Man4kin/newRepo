&НаКлиенте
Процедура Распределить(Команда)
	мсвОтбор = Список.НайтиСтроки(Новый Структура("Отбор",Истина));
	Если мсвОтбор.Количество()=0 Тогда 
		Сообщить("Нет данных для обработки");
		Возврат;
	КонецЕсли;
	сзПП = Новый СписокЗначений;
	Для Каждого стр Из мсвОтбор Цикл 
		сзПП.Добавить(стр.ПланируемаяПоставка);
	КонецЦикла;
	ПараметрыФормы = Новый Структура("ПланируемыеПоставки",сзПП);
	ОткрытьФорму("Обработка.Izh_РаспределениеТовара.Форма.Форма", ПараметрыФормы);
КонецПроцедуры

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ
	               |	ПриходнаяНакладная.Ссылка КАК Документ,
	               |	ПриходнаяНакладная.Склад,
	               |	ПриходнаяНакладная.СуммаИтого КАК Сумма,
	               |	ЛОЖЬ КАК Отбор,
	               |	РегистрСведенийIzh_ИсторияРаспределения.Документ.Ссылка КАК ПланируемаяПоставка,
	               |	РегистрСведенийIzh_ИсторияРаспределения.Закупщик КАК Закупщик
	               |ИЗ
	               |	РегистрСведений.Izh_ИсторияРаспределения КАК РегистрСведенийIzh_ИсторияРаспределения
	               |		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.АктПриемки КАК АктПриемки
	               |		ПО РегистрСведенийIzh_ИсторияРаспределения.Документ = АктПриемки.ДокОснование
	               |		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ПриходнаяНакладная КАК ПриходнаяНакладная
	               |		ПО РегистрСведенийIzh_ИсторияРаспределения.Документ = ПриходнаяНакладная.ДокОснование
	               |ГДЕ
	               |	НЕ АктПриемки.Ссылка ЕСТЬ NULL 
	               |	И ПриходнаяНакладная.Проведен
	               |
	               |СГРУППИРОВАТЬ ПО
	               |	ПриходнаяНакладная.Ссылка,
	               |	ПриходнаяНакладная.Склад,
	               |	ПриходнаяНакладная.СуммаИтого,
	               |	РегистрСведенийIzh_ИсторияРаспределения.Документ.Ссылка,
	               |	РегистрСведенийIzh_ИсторияРаспределения.Закупщик";
	тз = Запрос.Выполнить().Выгрузить();
	ЗначениеВРеквизитФормы(тз, "Список");
КонецПроцедуры

&НаКлиенте
Процедура СписокВыбор(Элемент, ВыбраннаяСтрока, Поле, СтандартнаяОбработка)
	ТекСтрока = Элементы.Список.ТекущиеДанные;
	Если ТекСтрока <> Неопределено Тогда
		ОткрытьЗначение(ТекСтрока.Документ);
	КонецЕсли;
КонецПроцедуры
