
&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	НаборЗаписей1 = РегистрыСведений.ПищеваяЦенность.СоздатьНаборЗаписей();
	НаборЗаписей1.Отбор.ТехнологическаяКарта.Значение = Документы.ТехнологическаяКарта.ПустаяСсылка();
	НаборЗаписей1.Отбор.ТехнологическаяКарта.Использование = Истина;
	НаборЗаписей1.Отбор.ТехнологическаяКарта.ВидСравнения = ВидСравнения.Равно;
	НаборЗаписей1.Прочитать();
	НаборЗаписей.Загрузить(НаборЗаписей1.Выгрузить());
	Если НЕ ПравоДоступа("Изменение", Метаданные.РегистрыСведений.ПищеваяЦенность) ИЛИ НЕ СтруктурныеЕдиницы.ЕстьВГруппеТипСЕ(Перечисления.ТипыСтруктурныхЕдиниц.Производство) Тогда
		Элементы.НаборЗаписей.ТолькоПросмотр = Истина;
		Элементы.НаборЗаписейЗаписать.Доступность = Ложь;
	КонецЕсли;
КонецПроцедуры

&НаКлиенте
Процедура НаборЗаписейПередНачаломДобавления(Элемент, Отказ, Копирование, Родитель, Группа)
	Отказ = Истина;
	ПодборОткрыть(Неопределено);
КонецПроцедуры

&НаСервере
Функция ПолучитьСтруктуруЗапросаПодбора() Экспорт
	СтруктураПодбора = Новый Структура;
	СтруктураПодбора.Вставить("ТекстЗапроса",ПодборНоменклатуры.ТекстЗапроса);
	СтруктураПодбора.Вставить("Параметры",ПодборНоменклатуры.Параметры);
	Возврат СтруктураПодбора;
КонецФункции	

&НаКлиенте
Процедура ПоказатьГруппыВПодборе(Команда)
	элементы.кнГруппы.пометка = не элементы.кнГруппы.пометка;
	флаг = Элементы.кнГруппы.пометка;
	ВЫполнить("ОбработкаТабличныхЧастейКлиент.ОтображениеГрупп(ПодборНоменклатуры,флаг)");
КонецПроцедуры

&НаСервере
Процедура Сохранитьпараметрыподбора()
	ПОдборНоменклатурыСервер.СохранитьПараметрыПодбора("ПищеваяЦенность",ЭтаФорма.ИмяФормы,ЭтаФорма.Элементы);
конецпроцедуры



&НаКлиенте
Процедура ПодборОткрыть(Команда)
	Элементы.ГруппаПодбор.Видимость = НЕ Элементы.ГруппаПодбор.Видимость;
КонецПроцедуры

&НаСервере
Функция получитьНастройкуПодбора()
	возврат подборНоменклатурыСервер.ПолучитьНастройкуподбора("ПищеваяЦенность",ЭтаФорма.ИмяФормы);	
конецфункции

&НаКлиенте
процедура ЗагрузитьНастройкиПодбора()
		Настройки = ПолучитьНастройкуПодбора();
		ОбработкаТабличныхЧастейКлиент.загрузитьнастройкиподбора(ЭтаФорма,Настройки);
конецпроцедуры

&НаКлиенте
Процедура ПодборЗакрыть(Команда)
	Элементы.ГруппаПодбор.Видимость  = Ложь;
КонецПроцедуры


&НаКлиенте
Процедура Дерево(Команда)
	обработкатабличныхчастейклиент.ОтображениеДинамическогоСпискаДерево(ЭтаФорма);	
КонецПроцедуры


&НаКлиенте
Процедура Иерархия(Команда)
	обработкатабличныхчастейклиент.отображениединамическогоспискаиерархия(этаформа);	
КонецПроцедуры


&НаКлиенте
Процедура Список(Команда)
	обработкатабличныхчастейклиент.ОтображениеДинамическогоСпискаСписок(этаформа);	
КонецПроцедуры


&НаКлиенте
Процедура ПодборНоменклатурыВыбор(Элемент, ВыбраннаяСтрока, Поле, СтандартнаяОбработка)
	Для Каждого Строка Из Элемент.ВыделенныеСтроки Цикл
		ТекСтрока = ОбработкаТабличныхЧастейКлиент.ЗаполнитьИзПодбора(ЭтаФорма,НаборЗаписей,Элемент.ДанныеСтроки(Строка),Элементы.НаборЗаписей,СтандартнаяОбработка,,Ложь,"НаборЗаписей");	
		Если ТекСтрока <> Неопределено Тогда
			ТекСтрока.НовоеЗначение = Истина;
		КонецЕсли;	
	КонецЦикла;	
КонецПроцедуры

&НаКлиенте
Процедура ПищеваяЦенностьПриИзменении(Элемент)
	Элементы.НаборЗаписей.ТекущиеДанные.НовоеЗначение = Истина;
	Модифицированность = Истина;
КонецПроцедуры


&НаКлиенте
Процедура ЗаписатьНабор(Команда)
	ЗаписатьНаборНаСервере();
КонецПроцедуры

&НаСервере
Процедура ЗаписатьНаборНаСервере()
	Для Каждого Строка Из НаборЗаписей Цикл
		Если Строка.НовоеЗначение Тогда
			Запись = РегистрыСведений.ПищеваяЦенность.СоздатьМенеджерЗаписи();
			ЗаполнитьЗначенияСвойств(Запись,Строка);
			Запись.Записать();
			Строка.НовоеЗначение = Ложь;
			//Сообщить(Строка.Номенклатура);
		КонецЕсли;
	КонецЦикла;
	Для Каждого Строка Из СписокУдаленных Цикл
		Запись = РегистрыСведений.ПищеваяЦенность.СоздатьМенеджерЗаписи();
		Запись.Номенклатура = Строка.Значение;
		Запись.ТехнологическаяКарта = Документы.ТехнологическаяКарта.ПустаяСсылка();
		Запись.Прочитать();
		Запись.Удалить();
		//Сообщить(Строка.Номенклатура);
	КонецЦикла;
	СписокУдаленных.Очистить();
	Модифицированность = Ложь;
КонецПроцедуры


&НаКлиенте
Процедура ПередЗаписью(Отказ, ПараметрыЗаписи)
	Отказ = Истина;
	ЗаписатьНаборНаСервере();
КонецПроцедуры


&НаКлиенте
Процедура НаборЗаписейПередУдалением(Элемент, Отказ)
	СписокУдаленных.Добавить(Элементы.НаборЗаписей.ТекущиеДанные.Номенклатура);
	Модифицированность = Истина;
КонецПроцедуры


&НаКлиенте
Процедура ПриОткрытии(Отказ)
	загрузитьНастройкиПодбора();
КонецПроцедуры


&НаКлиенте
Процедура ПриЗакрытии()
	СохранитьПараметрыПодбора();
КонецПроцедуры

