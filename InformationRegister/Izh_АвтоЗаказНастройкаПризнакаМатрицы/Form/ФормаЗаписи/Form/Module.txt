&НаСервереБезКонтекста
Функция ПолучитьСписокПризнаковПротоколаМатрицы()
	спСвойств = Новый СписокЗначений;
	Запрос = Новый Запрос("ВЫБРАТЬ
	|	ЗначенияСвойствОбъектов.Ссылка
	|ИЗ
	|	Справочник.ЗначенияСвойствОбъектов КАК ЗначенияСвойствОбъектов
	|ГДЕ
	|	ЗначенияСвойствОбъектов.Владелец = &Владелец");
	КодПВХ = ОбщегоНазначения.ПолучитьЗначениеСвойстваСлужебногоЗначения(ПланыВидовХарактеристик.СлужебныеЗначения.КодРеквизитаПризнакМатрицы);
	Запрос.УстановитьПараметр("Владелец",ПланыВидовХарактеристик.ДополнительныеРеквизитыНоменклатуры.НайтиПоКоду(КодПВХ));
	РезультатЗапроса = Запрос.Выполнить();
	Выборка = РезультатЗапроса.Выбрать();
	Пока Выборка.Следующий() Цикл
		спСвойств.Добавить(Выборка.Ссылка);
	КонецЦикла;
	Возврат спСвойств;
КонецФункции

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	СписокВыбора = Элементы.Свойство.СписокВыбора;
	спСвойств = ПолучитьСписокПризнаковПротоколаМатрицы();
	Для Каждого ЭлементСписка из спСвойств Цикл
		СписокВыбора.Добавить(ЭлементСписка.Значение);	
	КонецЦикла;
	Если НЕ Запись.ИсходныйКлючЗаписи.Пустой() Тогда 
		РегСведМенеджерЗаписи = ДанныеФормыВЗначение(Запись,Тип("РегистрСведенийМенеджерЗаписи.Izh_АвтоЗаказНастройкаПризнакаМатрицы"));
		Цвет = РегСведМенеджерЗаписи.Цвет.Получить();
	КонецЕсли;	
КонецПроцедуры

&НаСервере
Процедура ПередЗаписьюНаСервере(Отказ, ТекущийОбъект, ПараметрыЗаписи)
	Хранилище = Новый ХранилищеЗначения(Цвет);
	ТекущийОбъект.Цвет = Хранилище;
КонецПроцедуры
