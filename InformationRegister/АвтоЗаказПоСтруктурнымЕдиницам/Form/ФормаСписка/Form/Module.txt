&НаКлиенте
Процедура ПодборОткрыть(Команда)
	Элементы.ГруппаПодбор.Видимость = НЕ Элементы.ГруппаПодбор.Видимость;
КонецПроцедуры

&НаКлиенте
Процедура ПодборЗакрыть(Команда)
	Элементы.ГруппаПодбор.Видимость  = Ложь;
КонецПроцедуры

&НаКлиенте
Процедура СписокПередНачаломДобавления(Элемент, Отказ, Копирование, Родитель, Группа)
	Отказ = Истина;
	ПодборОткрыть(Неопределено);
КонецПроцедуры

&НаКлиенте
Процедура СписокСтруктурныхЕдиницВыбор(Элемент, ВыбраннаяСтрока, Поле, СтандартнаяОбработка)
	СтандартнаяОбработка = Ложь;
	ЗаписатьВРегистрПравило(Элементы.СписокСтруктурныхЕдиниц.ТекущаяСтрока);
	Элементы.Список.Обновить();
КонецПроцедуры

&НаСервере
Процедура ЗаписатьВРегистрПравило(СтруктурнаяЕдиница)
	Если СтруктурнаяЕдиница = Справочники.СтруктурныеЕдиницы.Центр Тогда
		Возврат;
	КонецЕсли;	
	Запись = РегистрыСведений.АвтоЗаказПоСтруктурнымЕдиницам.СоздатьМенеджерЗаписи();
	Запись.Правило = Правило;
	Запись.СтруктурнаяЕдиница = СтруктурнаяЕдиница;
	Запись.Записать();
КонецПроцедуры

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	Попытка
		Правило = Параметры.Отбор.Правило;
		Владелец = Правило.Владелец;
		Если ТипЗнч(Владелец) = Тип("СправочникСсылка.Контрагенты") Тогда
			Если Владелец.ПротоколРЦ ИЛИ Правило.Izh_ВариантРасчета = 1 Тогда
				ОбщегоНазначенияКлиентСервер.УстановитьЭлементОтбораДинамическогоСписка(СписокСтруктурныхЕдиниц,"ТипСтруктурнойЕдиницы",Перечисления.ТипыСтруктурныхЕдиниц.Склад,ВидСравненияКомпоновкиДанных.Равно,,Истина,,);
			КонецЕсли;
		КонецЕсли;
	Исключение
		Отказ = Истина;
	КонецПопытки;	
КонецПроцедуры
