// {ВетровИА 2015-08-11 Обращение 0000134674 

// Функция - Получить шаблоны ценника
//
// Параметры:
//  СписокНоменклатуры	 - Массив	-  Список номенклатуры для которой необходимо получить шаблон ценников.
//  Дата				 - Дата	 - Дата, на когторую необходимо получить шаблон ценников.
// Возвращаемое значение:
// Соответствие  - Соответствие Номенклатуры(ключ) и Шаблона ценника(значение).
Функция ПолучитьШаблоныЦенника(СписокНоменклатуры, Дата) Экспорт
	НоменклатураШаблонЦенников = Новый Соответствие;
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ
	               |	Izh_ПравилаВыбораШаблонаЦенника.Приоритет КАК Приоритет,
	               |	Izh_ПравилаВыбораШаблонаЦенника.Представление,
	               |	Izh_ПравилаВыбораШаблонаЦенника.Правило,
	               |	Izh_ПравилаВыбораШаблонаЦенника.ШаблонЦенника
	               |ИЗ
	               |	РегистрСведений.Izh_ПравилаВыбораШаблонаЦенника КАК Izh_ПравилаВыбораШаблонаЦенника
	               |
	               |УПОРЯДОЧИТЬ ПО
	               |	Приоритет";
				   
	ТЗПравилаВыбораШаблонаЦенника = Запрос.Выполнить().Выгрузить(); 			   
	
	Для Каждого Номенклатура ИЗ СписокНоменклатуры Цикл
		ЦенникЗа100гСсылка = Номенклатура.ДополнительныеРеквизиты.Найти(ПланыВидовХарактеристик.ДополнительныеРеквизитыНоменклатуры.Реквизит("ЦенникЗа100г"));
		Если ЦенникЗа100гСсылка <> Неопределено Тогда
			ЦенникЗа100г = ЦенникЗа100гСсылка.Значение;
		Иначе
			ЦенникЗа100г = Ложь;
		КонецЕсли;	
		СтруктураВходныхДанных = Новый Структура("Номенклатура, Дата, ЦенникЗа100г", Номенклатура, Дата, ЦенникЗа100г);
		Параметр = Ложь;		
		СтруктураАкционныйТовар = Izh_ОбщегоНазначения.ПолучитьДанныеПоАкционномуТовару(СтруктураВходныхДанных.Номенклатура, СтруктураВходныхДанных.Дата);
		Для Каждого ПравилаВыбораШаблонаЦенника ИЗ ТЗПравилаВыбораШаблонаЦенника Цикл
			Выполнить(ПравилаВыбораШаблонаЦенника.Правило);
			Если Параметр Тогда
				НоменклатураШаблонЦенников.Вставить(Номенклатура, ПравилаВыбораШаблонаЦенника.ШаблонЦенника);
				Прервать; 	
			КонецЕсли	
		КонецЦикла	
	КонецЦикла;
	Возврат НоменклатураШаблонЦенников;  
КонецФункции	
// ВетровИА 2015-08-11 Обращение 0000134674} 