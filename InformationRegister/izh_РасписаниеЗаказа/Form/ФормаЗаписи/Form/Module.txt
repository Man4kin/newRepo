&НаКлиенте
Процедура ОбработкаОповещения(ИмяСобытия, Параметр, Источник)
	Если ИмяСобытия = "ИзмененоРасписание" Тогда
		Запись.ПредставлениеРасписания = Строка(Параметр);
		РасписаниеНаФорме = Параметр;
		ЭтаФорма.Модифицированность = Истина;
		ЭтаФорма.ОбновитьОтображениеДанных();
	КонецЕсли;
КонецПроцедуры

&НаСервере                                                        
Функция ПолучитьРасписание()
	Значение = ДанныеФормыВЗначение(Запись,Тип("РегистрСведенийМенеджерЗаписи.izh_РасписаниеЗаказа"));
	Расписание = Значение.Расписание.Получить();
	Возврат Расписание;
КонецФункции

&НаСервере
Процедура ПередЗаписьюНаСервере(Отказ, ТекущийОбъект, ПараметрыЗаписи)
	Если РасписаниеНаФорме <> Неопределено Тогда
		Если ЗначениеЗаполнено(РасписаниеНаФорме.ВремяЗавершения) 
				ИЛИ ЗначениеЗаполнено(РасписаниеНаФорме.ВремяКонца)
				ИЛИ ЗначениеЗаполнено(РасписаниеНаФорме.ВремяНачала) Тогда
			ОбщегоНазначенияКлиентСервер.СообщитьПользователю("В расписании нельзя указывать время, т.к. это повлияет на вычислении даты поставки",,,,Отказ);
		КонецЕсли;
		ТекущийОбъект.Расписание = Новый ХранилищеЗначения(РасписаниеНаФорме, Новый СжатиеДанных());	
		ТекущийОбъект.ПредставлениеРасписания = Строка(РасписаниеНаФорме);
	КонецЕсли;	
КонецПроцедуры

&НаКлиенте
Процедура ПредставлениеРасписанияНачалоВыбора(Элемент, ДанныеВыбора, СтандартнаяОбработка)
	СтандартнаяОбработка = Ложь;
	Если РасписаниеНаФорме = Неопределено Тогда
		Расписание = ПолучитьРасписание();
		Если Расписание = Неопределено Тогда
			Расписание = Новый РасписаниеРегламентногоЗадания;
		КонецЕсли;	
	Иначе
		Расписание = РасписаниеНаФорме;
	КонецЕсли;	
	Диалог = Новый ДиалогРасписанияРегламентногоЗадания(Расписание);
	Если Диалог.ОткрытьМодально() Тогда
		Расписание = Диалог.Расписание;
		Оповестить("ИзмененоРасписание",Диалог.Расписание,Запись);
	КонецЕсли;
КонецПроцедуры

