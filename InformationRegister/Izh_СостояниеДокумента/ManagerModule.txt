Функция ДокументЗафиксированВСостоянии(Объект,Состояние) Экспорт
	Ссылка = СсылкаНаОбъект(Объект);
	Если НЕ ЗначениеЗаполнено(Ссылка) Тогда
		Возврат Ложь;
	КонецЕсли;
	Результат = РегистрыСведений.Izh_СостояниеДокумента.СрезПоследних(ТекущаяДата(),Новый Структура("Документ,Состояние",Ссылка,Состояние));
	Возврат Результат.Количество()>0;
КонецФункции

Функция СсылкаНаОбъект(Знач Объект)
	
	Если ОбщегоНазначения.ЗначениеСсылочногоТипа(Объект) Тогда
		Ссылка = Объект;
	Иначе
		Попытка
			Ссылка = Объект.Ссылка;
		Исключение
			Возврат Неопределено;
		КонецПопытки;
	КонецЕсли;
	
	Если НЕ Метаданные.РегистрыСведений.Izh_СостояниеДокумента.Измерения.Документ.Тип.СодержитТип(ТипЗнч(Ссылка)) Тогда
		Возврат Неопределено;
	КонецЕсли;
	
	Возврат Ссылка;
	
КонецФункции

Процедура ЗафиксироватьДокумент(Объект,Состояние) Экспорт
	Ссылка = СсылкаНаОбъект(Объект);
	Если НЕ ЗначениеЗаполнено(Ссылка) Тогда
		Возврат ;
	КонецЕсли;
	Запись = РегистрыСведений.Izh_СостояниеДокумента.СоздатьМенеджерЗаписи();
	Запись.Период = ТекущаяДата();
	Запись.Документ = Ссылка;
	Запись.Состояние = Состояние;
	Запись.Сотрудник = ПараметрыСеанса.ТекущийПользователь;
	Запись.Записать(Истина);
КонецПроцедуры