
&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	для каждого СтрокаОтбора из Параметры.Отбор цикл
		Если ТипЗнч(СтрокаОтбора.Значение) = Тип("СправочникСсылка.Номенклатура") тогда
			ИмяОтбора = "Номенклатура";
			Номенклатура = СтрокаОтбора.Значение;
			Список.Параметры.УстановитьЗначениеПараметра("Номенклатура", Номенклатура);
		Иначе
			Продолжить;
		Конецесли;
		Элементы.Список.ПодчиненныеЭлементы[ИмяОтбора].Видимость = Ложь;
	конеццикла;
	СписокТекстЗапроса = Список.ТекстЗапроса;
	Если Номенклатура.Пустая() Тогда
		Список.ОсновнаяТаблица = "РегистрСведений.ЦеныНоменклатуры";
		Список.ПроизвольныйЗапрос = Истина;
		Список.ТекстЗапроса = "ВЫБРАТЬ
		                      |	ЦеныНоменклатуры.Период,
		                      |	ЦеныНоменклатуры.СтруктурнаяЕдиница,
		                      |	ЦеныНоменклатуры.Номенклатура,
		                      |	ЦеныНоменклатуры.ЕдиницаИзмерения,
		                      |	ЦеныНоменклатуры.ID,
		                      |	ЦеныНоменклатуры.Цена,
		                      |	ЦеныНоменклатуры.IDВосстановления,
		                      |	ЦеныНоменклатуры.АктивностьЗаписи
		                      |ИЗ
		                      |	РегистрСведений.ЦеныНоменклатуры КАК ЦеныНоменклатуры";
		Элементы.ФормаСрезПоследних.Доступность = Ложь;					  
	КонецЕсли;	
	
КонецПроцедуры

&НаКлиенте
Процедура СрезПоследних(Команда)
	Элементы.ФормаСрезПоследних.Пометка = Не Элементы.ФормаСрезПоследних.Пометка;
	ЗаменитьОсновнуюТаблицу(Элементы.ФормаСрезПоследних.Пометка);
КонецПроцедуры

&НаСервере
Процедура ЗаменитьОсновнуюТаблицу(Пометка)
	Если Пометка Тогда
		Список.ОсновнаяТаблица = "РегистрСведений.ЦеныНоменклатуры.СрезПоследних";
		Список.ПроизвольныйЗапрос = Истина;
		Список.ТекстЗапроса = СписокТекстЗапроса;
		Список.Параметры.УстановитьЗначениеПараметра("Номенклатура", Номенклатура);
	Иначе
		Список.ОсновнаяТаблица = "РегистрСведений.ЦеныНоменклатуры";
		Список.ПроизвольныйЗапрос = Истина;
		Список.ТекстЗапроса = "ВЫБРАТЬ
		                      |	ЦеныНоменклатуры.Период,
		                      |	ЦеныНоменклатуры.СтруктурнаяЕдиница,
		                      |	ЦеныНоменклатуры.Номенклатура,
		                      |	ЦеныНоменклатуры.ЕдиницаИзмерения,
		                      |	ЦеныНоменклатуры.ID,
		                      |	ЦеныНоменклатуры.Цена,
		                      |	ЦеныНоменклатуры.IDВосстановления,
		                      |	ЦеныНоменклатуры.АктивностьЗаписи
		                      |ИЗ
		                      |	РегистрСведений.ЦеныНоменклатуры КАК ЦеныНоменклатуры
		                      |ГДЕ
		                      |	ЦеныНоменклатуры.Номенклатура = &Номенклатура";
		Список.Параметры.УстановитьЗначениеПараметра("Номенклатура", Номенклатура);
	КонецЕсли;
КонецПроцедуры

