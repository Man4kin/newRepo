
&НаКлиенте
Процедура КонтрагентыПриАктивизацииСтроки(Элемент)
	Если Элемент.ТекущаяСтрока = Неопределено Тогда
		Возврат;
	КонецЕсли;
	Правила.Отбор.Элементы.Очистить();
	Отбор = Правила.Отбор.Элементы.Добавить(Тип("ЭлементОтбораКомпоновкиДанных"));
	Отбор.Использование = Истина;
	Отбор.ВидСравнения = ВидСравненияКомпоновкиДанных.Равно;
	Отбор.ЛевоеЗначение = Новый ПолеКомпоновкиДанных("Владелец");
	Отбор.ПравоеЗначение = Элемент.ТекущаяСтрока;
КонецПроцедуры

&НаКлиенте
Процедура ПравилаПриАктивизацииСтроки(Элемент)
	Если Элемент.ТекущаяСтрока = Неопределено Тогда
		СтруктурныеЕдиницы.Очистить();
		Возврат;
	КонецЕсли;
	ЗаполнитьСписокСЕ(Элемент.ТекущаяСтрока);
КонецПроцедуры

&НаСервере
Процедура ЗаполнитьСписокСЕ(ТекущееПравило)
	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	СтруктурныеЕдиницы.Ссылка КАК СтруктурнаяЕдиница,
		|	ВЫБОР
		|		КОГДА СтруктурныеЕдиницы.Ссылка = АвтоЗаказПоСтруктурнымЕдиницам.СтруктурнаяЕдиница
		|			ТОГДА ИСТИНА
		|		ИНАЧЕ ЛОЖЬ
		|	КОНЕЦ КАК Флаг,
		|	СтруктурныеЕдиницы.Код,
		|	АвтоЗаказПоСтруктурнымЕдиницам.СтруктурнаяЕдиница КАК СтруктурнаяЕдиницаВРегистре
		|ИЗ
		|	Справочник.СтруктурныеЕдиницы КАК СтруктурныеЕдиницы
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.АвтоЗаказПоСтруктурнымЕдиницам КАК АвтоЗаказПоСтруктурнымЕдиницам
		|		ПО (АвтоЗаказПоСтруктурнымЕдиницам.СтруктурнаяЕдиница = СтруктурныеЕдиницы.Ссылка)
		|			И (АвтоЗаказПоСтруктурнымЕдиницам.Правило = &Правило)";

	Запрос.УстановитьПараметр("Правило", ТекущееПравило);
	СтруктурныеЕдиницы.Загрузить(Запрос.Выполнить().Выгрузить());
КонецПроцедуры

&НаКлиенте
Процедура СтруктурныеЕдиницыФлагПриИзменении(Элемент)
	ЗаписатьВРегистрПравило(Элементы.СтруктурныеЕдиницы.ТекущиеДанные.Флаг,Элементы.Правила.ТекущаяСтрока,Элементы.СтруктурныеЕдиницы.ТекущиеДанные.СтруктурнаяЕдиница);
КонецПроцедуры

&НаСервере
Процедура ЗаписатьВРегистрПравило(Флаг,Правило,СтруктурнаяЕдиница)
	Запись = РегистрыСведений.АвтоЗаказПоСтруктурнымЕдиницам.СоздатьМенеджерЗаписи();
	//Запись.Активность = Флаг;
	Запись.Правило = Правило;
	Запись.СтруктурнаяЕдиница = СтруктурнаяЕдиница;
	Запись.Записать();
КонецПроцедуры
