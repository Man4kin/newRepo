
&НаКлиенте
Процедура ФлажокВключенПриИзменении(Элемент)
	КомпонентаСканераШК.On = ФлажокВключен;
	РаботаСоСканеромШККлиент.СохранитьВНастройкахПараметры(ФлажокВключен, Порт);
КонецПроцедуры

&НаКлиенте
Процедура ПортПриИзменении(Элемент)
	КомпонентаСканераШК.Порт = Порт;
	РаботаСоСканеромШККлиент.СохранитьВНастройкахПараметры(ФлажокВключен, Порт);
КонецПроцедуры

&НаКлиенте
Процедура ПриОткрытии(Отказ)
	РаботаСоСканеромШККлиент.ПроинициализироватьКомпоненту();
	ОбновитьСостояние();
КонецПроцедуры

&НаКлиенте
Процедура УстановитьКомпонентуСканирования(Команда)
	РаботаСоСканеромШККлиент.УстановитьКомпоненту();
	ОбновитьСостояние();
КонецПроцедуры

&НаКлиенте
Процедура ОбновитьСостояние()
	Если КомпонентаСканераШК = Неопределено Тогда
		Элементы.ФлажокВключен.Доступность = Ложь;
		Элементы.Порт.Доступность = Ложь;
	Иначе	
		Версия = КомпонентаСканераШК.Версия;
		Элементы.Порт.СписокВыбора.Очистить();
		КолПортов = КомпонентаСканераШК.ПеречислитьПорты();
		Для П = 0 По КолПортов-1 Цикл 
			Элементы.Порт.СписокВыбора.Добавить(КомпонентаСканераШК.ПолучитьПорт(П));
		КонецЦикла;
		КомпонентаСканераШК.On = ФлажокВключен;
		КомпонентаСканераШК.Порт = Порт;
		Элементы.ФлажокВключен.Доступность = Истина;
		Элементы.Порт.Доступность = Истина;
	КонецЕсли;	
КонецПроцедуры

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	//Если Параметры.КомпонентаУстановлена Тогда
	//	Элементы.УстановитьКомпонентуСканирования.Видимость = Ложь;
	//КонецЕсли;	
	
	ИдентификаторКлиента = Параметры.ИдентификаторКлиента;
	
	ФлажокВключен = ХранилищеОбщихНастроек.Загрузить("НастройкиСканированияШК/Включен", ИдентификаторКлиента);
	Если ФлажокВключен = Неопределено Тогда
		ФлажокВключен = Истина;
		ХранилищеОбщихНастроек.Сохранить("НастройкиСканированияШК/Включен", ИдентификаторКлиента, ФлажокВключен);
	КонецЕсли;
	
	Порт = ХранилищеОбщихНастроек.Загрузить("НастройкиСканированияШК/Порт", ИдентификаторКлиента);
	Если Порт = Неопределено Тогда
		Порт = "COM1";
		ХранилищеОбщихНастроек.Сохранить("НастройкиСканированияШК/Порт", ИдентификаторКлиента, Порт);
	КонецЕсли;
	
	ФлажокВключен = ХранилищеОбщихНастроек.Загрузить("НастройкиСканированияШК/Включен", ИдентификаторКлиента);
	Порт =  ХранилищеОбщихНастроек.Загрузить("НастройкиСканированияШК/Порт", ИдентификаторКлиента);
	
КонецПроцедуры



